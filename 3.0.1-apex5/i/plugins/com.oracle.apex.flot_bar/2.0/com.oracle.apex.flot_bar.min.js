!function(util,server,$){com_oracle_apex_flot_bar=function(pRegionId,pOptions){function _create(tag){return $(document.createElement(tag))}function _init(pRegionId,pOptions){gChartOptions={series:{lines:{show:!1},bars:{show:!0,barWidth:(100-pOptions.spacing)/100,align:"center",horizontal:pOptions.horizontal,fill:1}},legend:{show:pOptions.showLegend},xaxis:{show:!0,axisLabel:pOptions.xAxisTitle},yaxis:{show:!0,axisLabel:pOptions.yAxisTitle},grid:{hoverable:!0,clickable:!0,borderColor:"#d3d3d3",borderWidth:1},shadowSize:0},pOptions.colors&&(gChartOptions.colors=pOptions.colors.split(",")),pOptions.splitSeries||"SIDE-BY-SIDE"!=pOptions.display||(gChartOptions.series.bars.mode="histogram",gChartOptions.series.bars.innerBarWidth=(100-pOptions.innerSpacing)/100),pOptions.horizontal?(gChartOptions.yaxis.mode="categories",gChartOptions.yaxis.tickLength=0,gChartOptions.xaxis.tickFormatter=_tickFormatter):(gChartOptions.xaxis.mode="categories",gChartOptions.xaxis.tickLength=0,gChartOptions.yaxis.tickFormatter=_tickFormatter),gOptions=pOptions,gRegion$=$("#"+util.escapeCSS(pRegionId),apex.gPageContext$),gChart$=$("#"+util.escapeCSS(pOptions.chartRegionId),apex.gPageContext$),gChart$.on("resize",_onResize).trigger("resize"),gPlot=$.plot(gChart$,[],gChartOptions),gChart$.on("resize",_fixLegend),gNoData$=_create("div").addClass("a-FlotBar-message").append(_create("div").addClass("a-FlotBar-messageIcon").append(_create("span").addClass("a-Icon icon-plugin-nodata"))).append(_create("span").addClass("a-FlotBar-messageText").text(pOptions.noDataFoundMessage)).hide(),gChart$.after(gNoData$),gOptions.showTooltip&&(gLabelTemplate='<div class="a-FlotBar-tooltip"><div>#inner#</div></div>',gTooltip$=$('<div id="'+util.escapeCSS(pRegionId)+'_tooltip" class="a-FlotBar-tooltip-container"></div>').appendTo(gChart$),gChart$.on("mousemove",_regionHover)),gChart$.on("plothover",_hover),gChart$.on("plotclick",_click),gRegion$.on("apexrefresh",_refresh).trigger("apexrefresh")}function _onResize(){gChart$.css("height",_recommendedHeight()+"px")}function _recommendedHeight(){var minAR=gOptions.minAR,maxAR=gOptions.maxAR,w=gChart$.width(),h=0===gChart$.height()?w/maxAR:gChart$.height(),ar=w/h;return minAR>ar?h=w/maxAR+1:ar>maxAR&&(h=w/minAR-1),Math.max(gOptions.minHeight,Math.min(gOptions.maxHeight,h))}function _click(pEvent,pPos,pObj){if(pObj){var dataPoint=gData[pObj.seriesIndex].data[pObj.dataIndex];dataPoint[3]&&window.location.assign(dataPoint[3])}}function _formatY(x){return(gOptions.valueTemplate||"#VALUE#").replace("#VALUE#",x)}function _tickFormatter(val,axis){return _formatY(val.toFixed(axis.tickDecimals))}function _renderTemplate(pObj){var result="",dataPoint=gData[pObj.seriesIndex].data[pObj.dataIndex];return gOptions.tooltipSeries&&(result+="<span><strong>"+(gSeriesName||pObj.series.label)+"</strong></span>"),(gOptions.tooltipX||gOptions.tooltipY)&&(result+="<span>",gOptions.tooltipX&&(result+=util.escapeHTML(dataPoint[gOptions.horizontal?1:0])),gOptions.tooltipX&&gOptions.tooltipY&&(result+="<strong>&nbsp;-&nbsp;</strong>"),gOptions.tooltipY&&(result+=util.escapeHTML(_formatY(dataPoint[gOptions.horizontal?0:1]))),result+="</span>"),gOptions.tooltipCustom&&dataPoint[2]&&(result+="<span>"+util.escapeHTML(dataPoint[2])+"</span>"),result}function _regionHover(e){hEvent=e.originalEvent}function _hover(pEvent,pPos,pObj){if(gHighlight&&(document.body.style.cursor="default",gPlot.unhighlight(gHighlight.series,gHighlight.datapoint),gHighlight=null,gOptions.showTooltip&&gTooltip$.hide()),pObj){var dataPoint=gData[pObj.seriesIndex].data[pObj.dataIndex];dataPoint[3]&&(document.body.style.cursor="pointer"),gPlot.highlight(pObj.series,pObj.datapoint),gOptions.showTooltip&&(gTooltip$.show().position({my:"left+20 center",at:"right center",of:hEvent,within:gRegion$}).css({"border-color":pObj.series.color}),gHighlight!==pObj&&gTooltip$.html(gLabelTemplate.replace(/#inner#/,_renderTemplate(pObj)))),gHighlight=pObj}}function _draw(pData){var dataArray=pData.data;if(dataArray.length>=1){gChart$.show(),gNoData$.hide();var series={},seriesCount=0;for(var i in dataArray)series[dataArray[i].series]||(seriesCount++,series[dataArray[i].series]=[]),series[dataArray[i].series].push([pOptions.horizontal?dataArray[i].y:dataArray[i].x,pOptions.horizontal?dataArray[i].x:dataArray[i].y,dataArray[i].tooltip,dataArray[i].link]);var colorArray=pData.colors,colors={};for(var i in colorArray)colors[colorArray[i].series]||(colors[colorArray[i].series]=colorArray[i].color);var formattedSeries=[];if(gSeriesName=null,gOptions.splitSeries)for(var k in series){gSeriesName=k;for(var j in series[k])formattedSeries.push({label:series[k][j][pOptions.horizontal?1:0],data:[series[k][j]],bars:{order:formattedSeries.length}})}else{var currentSeries;for(var k in series)currentSeries={stack:"STACKED"==gOptions.display,label:k,data:series[k],bars:{order:formattedSeries.length}},colors[k]&&(currentSeries.color=colors[k]),formattedSeries.push(currentSeries);if("SIDE-BY-SIDE"==gOptions.display)for(var i in formattedSeries)formattedSeries[i].bars.barWidth=gChartOptions.series.bars.barWidth/formattedSeries.length;else if("OVERLAY"==gOptions.display)for(var i in formattedSeries)formattedSeries[i].bars.fill=.4}gData=JSON.parse(JSON.stringify(formattedSeries)),gPlot.setData(formattedSeries),gPlot.setupGrid(),gPlot.draw(),_fixLegend()}else gChart$.hide(),gNoData$.show()}function _fixLegend(){if(gOptions.showLegend){$(".legend>div",gChart$).remove();var table=$(".legend>table",gChart$);$(".legendColorBox",table).each(function(i,element){var color=$("div>div",element).css("border-color");$(element).empty().append($("<div></div>").css("background-color",color))})}}function _clear(){}function _debug(){}function _refresh(){server.plugin(gOptions.ajaxIdentifier,{pageItems:gOptions.pageItems},{refreshObject:gRegion$,clear:_clear,success:_draw,error:_debug,loadingIndicator:gChart$,loadingIndicatorPosition:"append"})}var gOptions,gChartOptions,gRegion$,gChart$,gNoData$,gTooltip$,gData,gPlot,gHighlight,gLabelTemplate,gSeriesName;_init(pRegionId,pOptions);var hEvent}}(apex.util,apex.server,apex.jQuery);