!function(a,b,c,d,e,f){"use strict";function g(a){var b,c,d,e,g,h;for(b=0;b<a.length;b++)d=a[b],c=Z[d.property],e=d.component._modelComponent,h=e.getProperty(c),h&&(d.newValue===!0?g=h.getMetaData().yesValue:d.newValue===!1?g=h.getMetaData().noValue:"alignment"===d.property&&d.newValue?g=d.newValue.toUpperCase():"col"!==d.property&&"span"!==d.property&&"rowSpan"!==d.property||-1!==d.newValue?d.newValue!==f&&null!==d.newValue&&(g=""+d.newValue):g="",g!==f&&h.setValue(g))}function h(a){var b,c=null;return b=a.newComponentIndex,b===f&&(b=a.newIndex),b>0&&(c=a.newParentContainer.components[b-1]._modelComponent),c}function i(a){a.newParentContainer===a.prevParentContainer?a.newParentContainer=a.prevParentContainer=[a.newParentContainer._parent.id,a.newParentContainer.id]:(a.newParentContainer&&(a.newParentContainer=[a.newParentContainer._parent.id,a.newParentContainer.id]),a.prevParentContainer&&(a.prevParentContainer=[a.prevParentContainer._parent.id,a.prevParentContainer.id])),delete a.component$,delete a.newComponent$,delete a.container$,delete a.prevContainer$}function j(){var a=F.gridlayout("option");return{hideLegacyDisplayPoints:a.hideLegacyDisplayPoints,hideEmptyDisplayPoints:a.hideEmptyDisplayPoints,hideButtons:a.hideButtons,hideItems:a.hideItems,displayFrom:a.displayFrom,hideGlobalComponents:_}}function k(a){var c=F.gridlayout("option");c.displayFrom!==a.displayFrom&&F.gridlayout("option","displayFrom",a.displayFrom),b.each(["displayFrom","hideLegacyDisplayPoints","hideEmptyDisplayPoints","hideButtons","hideItems"],function(b,d){a[d]||c[d]===a[d]||F.gridlayout("option",d,a[d])}),a.hideGlobalComponents!==_&&(_=a.hideGlobalComponents,F.gridlayout("pageDataChanged"))}function l(a,b,c,d,e,f,g,h,i){var j=Object.create(eb);return j.changes=b,j.gl$=a,j.component$=c,j.container$=d,j.grid=e,j.row=f,j.column=g,j.index=h,j.alignment=i,j._label="move",j}function m(a,b,c,d,e,f,g,h,i){var j=Object.create(fb);return j.changes=b,j.gl$=a,j.component$=c,j.container$=d,j.grid=e,j.row=f,j.column=g,j.index=h,j.alignment=i,j._label="copy",j}function n(a,b,c,d,e,f,g,h,i){var j=Object.create(gb);return j.changes=b,j.gl$=a,j.componentTypeId=c,j.container$=d,j.grid=e,j.row=f,j.column=g,j.index=h,j.alignment=i,j._label="create",j}function o(a,b){var c=Object.create(hb);return c.changes=[],c.gl$=a,c.transaction=null,c._label=b.length>1?d.formatMessageNoEscape("PD.GLV.CMD.DEL_N",b.length):d.formatMessageNoEscape("PD.GLV.CMD.DEL",F.gridlayout("getComponents",b)[0].title),c}function p(a,b){a.id="t0001",a._modelComponent=b._modelComponent}function q(a){return a.iconClass}function r(b){var c,d,e,f,g,h,i,j=window.componentGallery.getComponentData(b);if(f=j.type,d={type:f,_galleryComponent:j,id:"t0002",title:j.title},f===P){for(g="",i="",c=0;c<j.values.length;c++)e=j.values[c],e.id===a.PROP.REGION_TEMPLATE?g=e.value:e.id===a.PROP.REGION_TYPE&&(i=e.value);for(d.displayPoints=[],h=a.getRegionTemplates()[g],w(h.displayPoints,d.displayPoints,null,i),c=0;c<d.displayPoints.length;c++)d.displayPoints[c].components=[]}return d}function s(a,b,c){var d,e=c,f=a.getProperty(b);return f&&(d=f.getMetaData().yesValue,e=f.getValue()===d),e}function t(a,b,c){var d=c,e=a.getProperty(b);return e&&(d=e.getValue(),null!==d&&""!==d||!c||(d=c)),d}function u(b){var c=b.parentId;return b.typeId===a.COMP_TYPE.REGION&&(c=t(b,a.PROP.PARENT_REGION,c)),c}function v(a){var b,c=[];for(b=0;b<a.length;b++)c.push(ib[a[b]]);return c}function w(b,c,e,f){var g,h,i,j,k=0;for(g=0;g<b.length;g++)i=b[g],h=i.name,"PAGE_ITEM"===i.types[0]&&(h=d.getMessage("PD.GLV.DP_ITEMS")),"RIGHT_OF_IR_SEARCH_BAR"===i.id&&(f&&"NATIVE_IR"!==f||e&&"NATIVE_IR"!==a.getComponents(a.COMP_TYPE.REGION,{id:e})[0].getProperty(a.PROP.REGION_TYPE).getValue()||!e&&!f)||(j={types:v(i.types),id:i.id,title:h,isGrid:i.hasGridSupport,isLegacy:i.isLegacy},e||f||(i.hasOwnProperty("glvSpan")||i.glvNewRow===!1?(j.span=i.glvSpan,j.newColumn=!i.glvNewRow,!j.newColumn&&j.span>k&&(j.newRow=!0),k=j.span):j.newRow=!0),"buttonContainer"===j.types[0]&&i.hasAlignment&&(j.hasAlignment=!0),c.push(j))}function x(a,b){return b.templateName=a.name,b.maxColumns=12,b.displayPoints=[],w(a.displayPoints,b.displayPoints,b.id),b}function y(a,b){var c=a.grid;return b.gridType=c.type.toLowerCase(),b.maxColumns=c.maxColumns,b.hasColumnSpan=c.hasColumnSpan,c.hasRowSpan!==f&&(b.hasRowSpan=c.hasRowSpan),b.alwaysUseMaxColumns=c.alwaysUseMaxColumns,b.displayPoints=[],w(a.displayPoints,b.displayPoints),b}function z(b,c,d,f){var g,h,i,j,k,l,m,n,o,p,q=[];for(g=0;g<b.length;g++){if(n={properties:[{id:a.PROP.REGION,value:f}]},"buttonContainer"===b[g])m=a.COMP_TYPE.BUTTON,n.properties.push({id:a.PROP.BUTTON_POSITION,value:c});else{if("itemContainer"!==b[g])throw"Unknown container type: "+b[g];m=a.COMP_TYPE.PAGE_ITEM}q.push({typeId:m,filter:n})}for(_&&(n.excludeGlobalPage=!0),h=a.getComponentsAdvanced(q),g=0;g<h.length;g++){if(i=h[g],i.typeId===a.COMP_TYPE.BUTTON)o=R,p=e.getComponentIconClass(R,s(i,a.PROP.BUTTON_IS_HOT,!1)?"hot":"normal");else{if(i.typeId!==a.COMP_TYPE.PAGE_ITEM)throw"Unexpected component type "+i.typeId;o=Q,p=e.getComponentIconClass(Q,t(i,a.PROP.ITEM_TYPE))}(o!==Q||(k=t(i,a.PROP.ITEM_TYPE),"NATIVE_HIDDEN"!==k))&&(j={type:o,id:i.id,title:i.getDisplayTitle(),iconClass:p,newGrid:s(i,a.PROP.GRID_NEW_GRID,!1),newRow:s(i,a.PROP.GRID_NEW_ROW,!1),col:1*t(i,a.PROP.GRID_COLUMN,-1),newCol:s(i,a.PROP.GRID_NEW_COLUMN,!0),span:1*t(i,a.PROP.GRID_COLUMN_SPAN,-1),hasErrors:i.hasErrors(),hasWarnings:i.hasWarnings(),isReadOnly:i.isReadOnly(),_modelComponent:i},l=1*t(i,a.PROP.GRID_ROW_SPAN,-1),l>0&&(j.rowSpan=l),e.isConditional(i)&&(j.isConditional=!0),d.push(j))}}function A(b,c){var d,f,g,h,i,j,k,l={properties:[{id:a.PROP.REGION,value:c}]};for(_&&(l.excludeGlobalPage=!0),f=a.getComponents(a.COMP_TYPE.BUTTON,l),d=0;d<f.length;d++)g=f[d],i=t(g,a.PROP.BUTTON_POSITION),b[i]&&(j=t(g,a.PROP.ALIGNMENT,null),k=s(g,a.PROP.BUTTON_IS_HOT,!1),h={type:R,id:g.id,title:g.getDisplayTitle(),iconClass:e.getComponentIconClass(R,k?"hot":"normal"),hasErrors:g.hasErrors(),hasWarnings:g.hasWarnings(),isReadOnly:g.isReadOnly(),_modelComponent:g},j&&(h.alignment=j.toLowerCase()),e.isConditional(g)&&(h.isConditional=!0),b[i].push(h))}function B(b,d,f){var g,h,i,j,k,l,m,n,o,p,q=a.getRegionTemplates();for(o=f?{properties:[{id:a.PROP.PARENT_REGION,value:f}]}:{properties:[{id:a.PROP.PARENT_REGION,value:""},{id:a.PROP.REGION_POSITION,value:d}]},_&&(o.excludeGlobalPage=!0),l=a.getComponents(a.COMP_TYPE.REGION,o),g=0;g<l.length;g++)if(m=l[g],e.isDisplayed(m))if(n={},j=t(m,a.PROP.REGION_TEMPLATE),k=q[j]){for(p={},n=x(k,{type:P,id:m.id,title:m.getDisplayTitle(),iconClass:e.getComponentIconClass(P,t(m,a.PROP.REGION_TYPE)),newGrid:s(m,a.PROP.GRID_NEW_GRID,!1),newRow:s(m,a.PROP.GRID_NEW_ROW,!1),col:1*t(m,a.PROP.GRID_COLUMN,-1),newCol:s(m,a.PROP.GRID_NEW_COLUMN,!0),span:1*t(m,a.PROP.GRID_COLUMN_SPAN,-1),hasErrors:m.hasErrors(),hasWarnings:m.hasWarnings(),isReadOnly:m.isReadOnly(),itemsAboveContent:"ABOVE"===t(m,a.PROP.ITEM_DISPLAY_POSITION,"ABOVE"),_modelComponent:m}),e.isConditional(m)&&(n.isConditional=!0),h=0;h<n.displayPoints.length;h++)i=n.displayPoints[h],i.components=[],"regionContainer"===i.types[0]?B(i.components,null,n.id):i.types.length>1||"itemContainer"===i.types[0]?z(i.types,i.id,i.components,n.id):"buttonContainer"===i.types[0]&&(p[i.id]=i.components);A(p,n.id),b.push(n)}else c.warn("Skipping region %s because no template found for id %s.",m.getDisplayTitle(),j)}function C(){return{type:O,iconClass:"icon-warning",gridType:"fixed",maxColumns:12,hasColumnSpan:!0,hasRowSpan:!1,alwaysUseMax:!1,title:d.getMessage("PD.GLV.EMPTY_GRID"),displayPoints:[]}}function D(){var b,c,d,e,f,g;if(!$)return C();if(g=a.getComponents(a.COMP_TYPE.PAGE),1!==g.length)return C();if(e=g[0],f=a.getPageTemplate(),!f)return C();for(b=y(f,{type:O,id:e.id,iconClass:"icon-page",title:e.getDisplayTitle(),hasErrors:e.hasErrors(),hasWarnings:e.hasWarnings(),isReadOnly:a.isPageReadOnly(),_modelComponent:e}),c=0;c<b.displayPoints.length;c++)d=b.displayPoints[c],d.components=[],B(d.components,d.id);return b}function E(a){var b,c,d={};for(b=0;b<a.displayPoints.length;b++)c=a.displayPoints[b],c.components=[],"regionContainer"===c.types[0]?B(c.components,null,a.id):c.types.length>1||"itemContainer"===c.types[0]?z(c.types,c.id,c.components,a.id):"buttonContainer"===c.types[0]&&(d[c.id]=c.components);A(d,a.id)}var F,G=e.CSS.IS_ERROR,H=e.CSS.IS_WARNING,I="icon-error",J="icon-warning",K="a-GridLayout-buttonContainer",L=".a-GridLayout-pageItem, .a-GridLayout-region, .a-GridLayout-button",M=".a-GridLayout-page, .a-GridLayout-pageItem, .a-GridLayout-region, .a-GridLayout-button",N=".a-GridLayout-page > h3, .a-GridLayout-pageItem > h3, .a-GridLayout-region > h3, .a-GridLayout-button > h3",O="page",P="region",Q="item",R="button",S="GLV_HIDE_LEGACY",T="GLV_HIDE_GLOBAL",U="GLV_HIDE_EMPTY",V="GLV_HIDE_BTNS",W="GLV_HIDE_ITEMS",X="glv",Y=b.apex.gridlayout.INDEX,Z={newGrid:a.PROP.GRID_NEW_GRID,newRow:a.PROP.GRID_NEW_ROW,col:a.PROP.GRID_COLUMN,newCol:a.PROP.GRID_NEW_COLUMN,span:a.PROP.GRID_COLUMN_SPAN,rowSpan:a.PROP.GRID_ROW_SPAN,alignment:a.PROP.ALIGNMENT},$=!1,_=!0,ab=null,bb=!1,cb=!1,db=!1,eb=b.extend(apex.commandHistory.baseCommand(),{execute:function(){this.changes?this.updateDataLayer():(ab=this,this.gl$.gridlayout("move",{},this.component$,this.container$,this.grid,this.row,this.column,this.index,this.alignment)),this.state=j()},updateDataLayer:function(b){function c(a,b){l.push({id:a,value:b})}var e,f,j,k,l=[];b&&(this.changes=b),b=this.changes,this._label=d.formatMessageNoEscape("PD.GLV.CMD.MOVE",this.changes.component.title),db=!0,this.transaction=a.transaction.start(X),j=b.component._modelComponent,b.newParentContainer!==b.prevParentContainer&&(e=b.newParentContainer,f=e._parent,b.component.type===P?f.type===O?(c(a.PROP.PARENT_REGION,""),c(a.PROP.REGION_POSITION,e.id)):c(a.PROP.PARENT_REGION,f.id):b.component.type===Q?c(a.PROP.REGION,f.id):b.component.type===R&&(f!==b.prevParentContainer._parent?(c(a.PROP.REGION,f.id),c(a.PROP.BUTTON_POSITION,e.id)):e.id!==b.prevParentContainer.id&&c(a.PROP.BUTTON_POSITION,e.id))),k=h(b),j.move(k,l),g(b.propertyChanges),this.transaction.execute(),i(b)},undo:function(){var b,c=this.changes,d=c.prevGrid,e=c.prevRow,f=c.prevColumn,g=c.prevIndex;k(this.state),bb=!0,c.prevGridRemoved?g=Y.NEW_GRID:c.prevRowRemoved?g=Y.NEW_ROW:c.prevColumnRemoved&&(g=Y.NEW_COLUMN),c.newParentContainer===c.prevParentContainer&&(g>=0&&c.prevIndex>c.newIndex&&(g+=1),c.newGridInserted?c.newGrid<=c.prevGrid&&(d+=1):c.newRowInserted?c.newRow<=c.prevRow&&(e+=1):c.newColumnInserted&&c.newColumn<=c.prevColumn&&(f+=1)),db=!0,this.transaction.undo(),b=F.gridlayout("findComponentById",c.component.id),b.col=1*t(b._modelComponent,a.PROP.GRID_COLUMN,-1),b.col>=0&&(b.forceColumn=!0),this.gl$.gridlayout("move",{},c.component.id,c.prevParentContainer,d,e,f,g,c.prevAlignment)},redo:function(){var a=this.changes,b=a.newIndex;k(this.state),bb=!0,a.newGridInserted?b=Y.NEW_GRID:a.newRowInserted?b=Y.NEW_ROW:a.newColumnInserted?b=Y.NEW_COLUMN:a.newParentContainer===a.prevParentContainer&&a.newIndex>a.prevIndex&&(b+=1),db=!0,this.transaction.redo(),this.gl$.gridlayout("move",{},a.component.id,a.newParentContainer,a.newGrid,a.newRow,a.newColumn,b,a.newAlignment)},label:function(){return this._label}}),fb=b.extend(apex.commandHistory.baseCommand(),{execute:function(){this.changes?this.updateDataLayer():(ab=this,this.gl$.gridlayout("copy",{},this.component$,this.container$,this.grid,this.row,this.column,this.index,this.alignment)),this.state=j()},updateDataLayer:function(b){function c(a,b){l.push({id:a,value:b})}var e,f,j,k,l=[];b&&(this.changes=b),b=this.changes,this._label=d.formatMessageNoEscape("PD.GLV.CMD.COPY",this.changes.originalComponent.title),db=!0,cb=!0,this.transaction=a.transaction.start(X),j=b.component._modelComponent,j=b.component._modelComponent=j.duplicate(),b.component.id=j.id,b.component.title=j.getDisplayTitle(),F.gridlayout("update",b.component,!1),b.newParentContainer!==b.originalComponent._parent&&(e=b.newParentContainer,f=e._parent,b.component.type===P?f.type===O?(c(a.PROP.PARENT_REGION,""),c(a.PROP.REGION_POSITION,e.id)):c(a.PROP.PARENT_REGION,f.id):b.component.type===Q?c(a.PROP.REGION,f.id):b.component.type===R&&(c(a.PROP.REGION,f.id),c(a.PROP.BUTTON_POSITION,e.id))),k=h(b),j.move(k,l),g(b.propertyChanges),this.transaction.execute(),i(b)},undo:function(){var a=this.changes;k(this.state),bb=!0,this.gl$.gridlayout("remove",{},[a.component.id]),this.transaction.undo()},redo:function(){var a=this.changes,b=a.newIndex;k(this.state),bb=!0,a.newGridInserted?b=Y.NEW_GRID:a.newRowInserted?b=Y.NEW_ROW:a.newColumnInserted?b=Y.NEW_COLUMN:a.newParentContainer===a.prevParentContainer&&a.newIndex>a.prevIndex&&(b+=1),db=!0,cb=!0,this.gl$.gridlayout("add",{},a.component,a.newParentContainer,a.newGrid,a.newRow,a.newColumn,b,a.newAlignment,a.newComponent$),this.transaction.redo()},label:function(){return this._label}}),gb=b.extend(apex.commandHistory.baseCommand(),{execute:function(){this.changes?this.updateDataLayer():(ab=this,this.gl$.gridlayout("add",{},this.componentTypeId,this.container$,this.grid,this.row,this.column,this.index,this.alignment)),this.state=j()},updateDataLayer:function(b){function c(a,b){q.push({id:a,value:b})}var e,f,j,k,l,m,n,o,p=!1,q=[];for(b&&(this.changes=b),b=this.changes,n=b.component._galleryComponent,this._label=d.formatMessageNoEscape("PD.GLV.CMD.CREATE",n.title),this.transaction=a.transaction.start(X),f=b.newParentContainer,j=f._parent,b.component.type===P?(m=a.COMP_TYPE.REGION,j.type===O?(c(a.PROP.PARENT_REGION,""),c(a.PROP.REGION_POSITION,f.id)):c(a.PROP.PARENT_REGION,j.id)):b.component.type===Q?(m=a.COMP_TYPE.PAGE_ITEM,c(a.PROP.REGION,j.id)):b.component.type===R&&(m=a.COMP_TYPE.BUTTON,c(a.PROP.REGION,j.id),c(a.PROP.BUTTON_POSITION,f.id)),o=h(b),e=0;e<n.values.length;e++)k=n.values[e],q.push(k),k.id===a.PROP.ITEM_TYPE&&"NATIVE_HIDDEN"===k.value&&(p=!0);db=!0,cb=!0,l=new a.Component({previousComponent:o,typeId:m,values:q}),b.component._modelComponent=l,delete b.component._galleryComponent,p?(bb=!0,F.gridlayout("remove",{},b.newComponent$),this.changes=null):(g(b.propertyChanges),b.component.id=l.id,b.component.title=l.getDisplayTitle(),F.gridlayout("update",b.component,!1)),this.transaction.execute(),i(b)},undo:function(){var a=this.changes;k(this.state),a&&(bb=!0,this.gl$.gridlayout("remove",{},[a.component.id])),this.transaction.undo()},redo:function(){var a,b=this.changes;k(this.state),b&&(a=b.newIndex,bb=!0,db=!0,cb=!0,b.newGridInserted?a=Y.NEW_GRID:b.newRowInserted?a=Y.NEW_ROW:b.newColumnInserted?a=Y.NEW_COLUMN:b.newParentContainer===b.prevParentContainer&&b.newIndex>b.prevIndex&&(a+=1),this.gl$.gridlayout("add",{},b.component,b.newParentContainer,b.newGrid,b.newRow,b.newColumn,a,b.newAlignment,b.newComponent$)),this.transaction.redo()},label:function(){return this._label}}),hb=b.extend(apex.commandHistory.baseCommand(),{execute:function(){ab=this,this.gl$.gridlayout("remove",{}),this.state=j()},updateDataLayer:function(b){this.changes.push(b),this.transaction||(this.transaction=a.transaction.start(X)),b.component._modelComponent.remove(),i(b),b.lastChange&&this.transaction.execute()},undo:function(){var a,b,c,d=this.changes;for(k(this.state),a=d.length-1;a>=0;a--)b=d[a],bb=!0,c=b.prevIndex,b.prevGridRemoved?c=Y.NEW_GRID:b.prevRowRemoved?c=Y.NEW_ROW:b.prevColumnRemoved&&(c=Y.NEW_COLUMN),this.gl$.gridlayout("add",{},b.component,b.prevParentContainer,b.prevGrid,b.prevRow,b.prevColumn,c,b.prevAlignment,b.component$);this.transaction.undo()},redo:function(){var a,b=[],c=this.changes;for(k(this.state),bb=!0,a=0;a<c.length;a++)b.push(c[a].component.id);this.gl$.gridlayout("remove",{},b),this.transaction.redo()},label:function(){return this._label}}),ib={BUTTON:"buttonContainer",PAGE_ITEM:"itemContainer",REGION:"regionContainer"};b(document).ready(function(){function f(a){var b,c=!0;for(b=0;b<a.length;b++)if(a[b].isReadOnly){c=!1;break}return c}function g(){var a,b=F.gridlayout("getSelection").filter(L),c=F.gridlayout("getSelectedComponents"),d=f(c);0!==b.length&&d&&F.gridlayout("option","displayFrom")!==c[0].id&&(a=o(F,b),apex.commandHistory.execute(a))}function h(){var a,b=null,c=null,d=null,e=F.gridlayout("getSelection");1===e.length&&(this.col>=0&&(b=0,c=this.row,d=this.col),a=this.copy?m(F,null,e,this.container,b,c,d,this.index,this.alignment):l(F,null,e,this.container,b,c,d,this.index,this.alignment),apex.commandHistory.execute(a))}function i(a){var b,c=null,d=null,e=null;this.col>=0&&(c=0,d=this.row,e=this.col),b=n(F,null,a,this.container,c,d,e,this.index,this.alignment),apex.commandHistory.execute(b)}function j(a,b,c){function d(a){var d,e,f,g,h=[];for(f="grid"===l?z:A,d=0;d<f.length;d++)e=f[d],g={label:e.l,type:"action",action:b,container:i.element,index:e.i?e.i:a.index+e.a},"grid"===l?(g.row=e.i===Y.NEW_ROW?a.row+e.a:a.row,g.col=e.i===Y.NEW_COLUMN?a.col+e.a:a.col):a.alignment&&(g.alignment=a.alignment),c&&(g.copy=!0),h.push(g);return h}var e,f,g,h,i,j,k,l,m=null,n=[];for(a.length>0&&a[0].element.hasClass(K)&&(m={}),e=0;e<a.length;e++){if(i=a[e],m&&m.label!==i.region&&(m.label&&n.push(m),m={label:i.region,type:"subMenu",menu:{items:[]}}),g={label:m?i.name:i.label},l=i.type,0===i.items.length)g.type="action",g.action=b,g.container=i.element,g.index=0,"grid"===l?(g.row=0,g.col=0):i.alignment&&(g.alignment=i.alignment),c&&(g.copy=!0);else for(g.type="subMenu",g.menu={items:[]},j=g.menu.items,f=0;f<i.items.length;f++)h=i.items[f],k={label:h.name,type:"subMenu",menu:{items:d(h)}},j.push(k);m?m.menu.items.push(g):n.push(g)}return m&&n.push(m),n}function k(a){a=a||F.gridlayout("getSelectedComponents"),apex.actions.lookup("glv-disp-from-region").disabled=!(a.length>=1&&a[0].type===P&&a[0].id!==F.gridlayout("option","displayFrom")),apex.actions.update("glv-disp-from-region"),apex.actions.lookup("glv-disp-from-page").disabled=null===F.gridlayout("option","displayFrom"),apex.actions.update("glv-disp-from-page")}function v(a){var c,d,e,f,g,h="";for(b.isArray(a)||(a=[a]),c=0;c<a.length;c++){g=a[c],h+="["+g.component.id+": ";for(e in g.properties){for(h+=e+":",f=g.properties[e],d=0;d<f.length;d++)h+=f[d]+",";h=h.substring(0,h.length-1)+";"}h+="] "}return h}var w=[a.COMP_TYPE.PAGE,a.COMP_TYPE.REGION,a.COMP_TYPE.PAGE_ITEM,a.COMP_TYPE.BUTTON],x=b("#glvMenu"),y=null;F=b("#glv");var z=[{l:"Before",i:null,a:0},{l:"After",i:null,a:1},{l:"Row before",i:Y.NEW_ROW,a:0},{l:"Row after",i:Y.NEW_ROW,a:1},{l:"Column before",i:Y.NEW_COLUMN,a:0},{l:"Column after",i:Y.NEW_COLUMN,a:1}],A=[{l:"Before",i:null,a:0},{l:"After",i:null,a:1}];e.glvMakeTargetMenu=j,e.glvMenuAddAction=i,apex.actions.add([{name:"glv-disp-from-page",label:d.getMessage("PD.GLV.MI.DISP_PAGE"),shortcut:"Ctrl+Alt+T",disabled:!0,action:function(){F.gridlayout("option","displayFrom",null),k()}},{name:"glv-disp-from-region",label:d.getMessage("PD.GLV.MI.DISP_REGION"),shortcut:"Ctrl+Alt+D",disabled:!0,action:function(){var a=F.gridlayout("getSelectedComponents");a.length>=1&&a[0].type===P&&F.gridlayout("option","displayFrom",a[0].id),this.disabled=!0,apex.actions.update(this.name),apex.actions.lookup("glv-disp-from-page").disabled=!1,apex.actions.update("glv-disp-from-page")}},{name:"glv-hide-empty",label:d.getMessage("PD.GLV.MI.HIDE_EMPTY"),shortcut:"Ctrl+Alt+E",get:function(){return F.gridlayout("option","hideEmptyDisplayPoints")},set:function(a){F.gridlayout("option","hideEmptyDisplayPoints",a),saveBoolPref(U,a)}}]);var B={menubar:!1,items:[{id:"dispRoot",type:"action",action:"glv-disp-from-page"},{id:"dispHere",type:"action",action:"glv-disp-from-region"},{type:"toggle",action:"pd-expand-restore"},{type:"separator"},{id:"newgrid",type:"action",labelKey:"PD.GLV.MI.NEW_GRID",hide:!0},{id:"delete",type:"action",labelKey:"PD.DEL",accelerator:"Del",disabled:function(){var a=F.gridlayout("getSelectedComponents"),b=f(a);return a.length<1||1===a.length&&a[0].type===O||!b||F.gridlayout("option","displayFrom")===a[0].id},action:function(){g({})}},{id:"moveTo",type:"subMenu",disabled:!0,labelKey:"PD.MI.MOVE2",menu:{items:[]}},{id:"copyTo",type:"subMenu",disabled:!0,labelKey:"PD.MI.COPY2",menu:{items:[]}},{type:"separator"},{id:"hideConditional",type:"subMenu",disabled:!0,labelKey:"PD.GLV.MI.HIDE_COND_COMP",hide:!0,menu:{items:[]}},{type:"toggle",labelKey:"PD.GLV.MI.HIDE_LEGACY",get:function(){return F.gridlayout("option","hideLegacyDisplayPoints")},set:function(a){F.gridlayout("option","hideLegacyDisplayPoints",a),e.saveBoolPref(S,a)}},{type:"toggle",action:"glv-hide-empty"},{type:"toggle",labelKey:"PD.GLV.MI.HIDE_GLOBAL",disabled:function(){var b=F.gridlayout("option","displayFrom"),c=b?F.gridlayout("findComponentById",b)._modelComponent.isOnGlobalPage():!1;return!$||a.isGlobalPage()||c},get:function(){return _},set:function(a){_=a,F.gridlayout("pageDataChanged"),e.saveBoolPref(T,a)}},{type:"toggle",labelKey:"PD.GLV.MI.HIDE_BTNS",get:function(){return F.gridlayout("option","hideButtons")},set:function(a){F.gridlayout("option","hideButtons",a),e.saveBoolPref(V,a)}},{type:"toggle",labelKey:"PD.GLV.MI.HIDE_ITEMS",get:function(){return F.gridlayout("option","hideItems")},set:function(a){F.gridlayout("option","hideItems",a),e.saveBoolPref(W,a)}},{type:"subMenu",hide:!0,labelKey:"PD.GLV.MI.ZOOM",menu:{items:[{type:"radioGroup",set:function(a){F.gridlayout("option","zoom",a)},get:function(){return F.gridlayout("option","zoom")+""},choices:[{labelKey:d.formatMessage("PD.GLV.MI.ZOOM_N","50"),value:"50"},{labelKey:d.formatMessage("PD.GLV.MI.ZOOM_N","75"),value:"75"},{labelKey:d.formatMessage("PD.GLV.MI.ZOOM_N","100"),value:"100"},{labelKey:d.formatMessage("PD.GLV.MI.ZOOM_N","120"),value:"125"},{labelKey:d.formatMessage("PD.GLV.MI.ZOOM_N","150"),value:"150"},{labelKey:d.formatMessage("PD.GLV.MI.ZOOM_N","170"),value:"175"},{labelKey:d.formatMessage("PD.GLV.MI.ZOOM_N","200"),value:"200"}]}]}}],beforeOpen:function(){var a,b=x.menu("find","moveTo"),c=x.menu("find","copyTo"),d=F.gridlayout("getSelection").filter(L);b.menu.items=[],c.menu.items=[],1===d.length&&(a=d.eq(0),F.gridlayout("getComponents",a)[0].isReadOnly||(b.menu.items=j(F.gridlayout("getDropTargets",a),h),c.menu.items=j(F.gridlayout("getDropTargets",a,"copy"),h,!0))),b.disabled=0===b.menu.items.length,c.disabled=0===c.menu.items.length},afterClose:function(a,b){b.actionTookFocus||F.gridlayout("focus")}};x.menu(B),_=e.getBoolPref(T,!0),F.gridlayout({getPageRoot:D,hideLegacyDisplayPoints:e.getBoolPref(S,!0),hideEmptyDisplayPoints:e.getBoolPref(U,!1),hideButtons:e.getBoolPref(V,!1),hideItems:e.getBoolPref(W,!1),getIconForComponent:q,makeComponent:r,updateComponentCopy:p,deleteKeyAction:function(a){g(a)},contextMenuAction:function(a){var c,d;"contextmenu"===a.type?x.menu("toggle",a.pageX,a.pageY):(d=b(a.target),c=d.offset(),x.menu("toggle",c.left,c.top+d.find("h3").height()))},stateClassMap:{hasErrors:G,hasWarnings:H},stateIconMap:{hasErrors:I,hasWarnings:J},appendTo:"parent",cursor:"default",cursorAt:{left:2,top:2},containment:"document",multiple:!0,animate:!1,delay:10,distance:5,opacity:.9,scroll:!0,scrollSensitivity:30,iconType:"a-Icon",selectionChange:function(){var a,d,e,f=[];for(d=b(this).gridlayout("getSelectedComponents"),a=0;a<d.length;a++)e=d[a]._modelComponent,e?f.push(e):c.log("No component found for selection "+d[a].id);k(d),b(document).trigger("selectionChanged",[X,f])},added:function(a,b){var c;return bb?void(bb=!1):void(ab?(ab.updateDataLayer(b),ab=null):(c=n(F,b),apex.commandHistory.execute(c)))},removed:function(a,b){return bb?void(bb=!1):void(ab&&(ab.updateDataLayer(b),b.lastChange&&(ab=null)))},moved:function(a,b){var c;return bb?void(bb=!1):void(ab?(ab.updateDataLayer(b),ab=null):(c=l(F,b),apex.commandHistory.execute(c)))},copied:function(a,b){var c;return bb?void(bb=!1):void(ab?(ab.updateDataLayer(b),ab=null):(c=m(F,b),apex.commandHistory.execute(c)))},start:function(){apex.tooltipManager.disableTooltips()},stop:function(){apex.tooltipManager.enableTooltips()}}).tooltip({items:N,show:apex.tooltipManager.defaultShowOption(),content:function(){var a=F.gridlayout("getComponents",b(this).parent())[0];return a.note?a.note:a._modelComponent?e.tooltipContentForComponent(a._modelComponent):void 0}}).on("focusin",function(a){var c,d=b(a.target).closest(M);0!==d.length&&(c=b.Event(a),c.target=c.currentTarget=d.children("h3")[0],F.tooltip("open",c))}).on("focusout",function(a){var c,d=b(a.target).closest(M);0!==d.length&&(c=b.Event(a),c.target=c.currentTarget=d.children("h3")[0],F.tooltip("close",c))}).on("keyup",function(a){var c,d;if(a.keyCode===b.ui.keyCode.ESCAPE){if(d=b(a.target).closest(M),0===d.length)return;c=b.Event(a),c.currentTarget=d.children("h3")[0],F.tooltip("close",c)}}),b(document).on("selectionChanged",function(b,c,d){var e,f,g=[];if(c!==X){for(e=0;e<d.length;e++)f=d[e],(f.typeId===a.COMP_TYPE.PAGE||f.typeId===a.COMP_TYPE.REGION||f.typeId===a.COMP_TYPE.PAGE_ITEM||f.typeId===a.COMP_TYPE.BUTTON)&&g.push(f.id);F.is(":visible")?(F.gridlayout("setSelectedComponents",g),k()):y=g}}),b("#editor_tabs").on("tabsactivate",function(a,b){"grid_layout"===b.newPanel[0].id&&y&&(F.gridlayout("setSelectedComponents",y),k(),y=null)}),a.observer(X,{component:{typeIds:w},events:[a.EVENT.DISPLAY_TITLE]},function(a){var b=F.gridlayout("findComponentById",a.component.id);c.getLevel()>=c.LOG_LEVEL.APP_TRACE&&c.trace("GLV Handle display title change: "+v(a)),b&&(b.title=a.component.getDisplayTitle(),F.gridlayout("update",b,!1))}),a.observer(X,{component:{typeIds:w},events:[a.EVENT.CHANGE],properties:[a.PROP.CONDITION_TYPE,a.PROP.AUTHORIZATION_SCHEME,a.PROP.BUILD_OPTION,a.PROP.GRID_NEW_GRID,a.PROP.GRID_NEW_ROW,a.PROP.GRID_NEW_COLUMN,a.PROP.GRID_COLUMN,a.PROP.GRID_COLUMN_SPAN,a.PROP.GRID_ROW_SPAN,a.PROP.ALIGNMENT,a.PROP.ITEM_DISPLAY_POSITION,a.PROP.ITEM_TYPE,a.PROP.REGION_TYPE,a.PROP.BUTTON_IS_HOT,a.PROP.DISPLAY_SEQUENCE,a.PROP.REGION_POSITION,a.PROP.PARENT_REGION,a.PROP.REGION,a.PROP.BUTTON_POSITION]},function(d){function f(a){var c=n.properties[a];return c&&b.inArray("change",c)>=0}function g(a){return n.component.getProperty(a).getValue()}function h(a){var b=n.component.getProperty(a),c=b.getMetaData().yesValue;return b.getValue()===c}function i(a,b){for(var c=b._parent?b._parent._parent:null;c;){if(a[c.id])return!0;c=c._parent?c._parent._parent:null}return!1}var j,k,l,m,n,o,p,q={},r={},w={};if(db)return void(db=!1);for(c.getLevel()>=c.LOG_LEVEL.APP_TRACE&&c.trace("GLV Handle property changes: "+v(d)),j=0;j<d.length;j++)n=d[j],k=n.component.id,l=u(n.component),o=F.gridlayout("findComponentById",k),p=F.gridlayout("findComponentById",l),!o&&p&&(w[l]=p),o&&(f(a.PROP.ITEM_TYPE)&&o.type===Q&&(m=g(a.PROP.ITEM_TYPE),"NATIVE_HIDDEN"===m?w[l]=p:(o.iconClass=e.getComponentIconClass(Q,t(n.component,a.PROP.ITEM_TYPE)),q[k]=o)),(f(a.PROP.CONDITION_TYPE)||f(a.PROP.AUTHORIZATION_SCHEME)||f(a.PROP.BUILD_OPTION))&&(e.isConditional(n.component)?o.isConditional=!0:delete o.isConditional,q[k]=o),f(a.PROP.REGION_TYPE)&&o.type===P&&(o.iconClass=e.getComponentIconClass(P,t(n.component,a.PROP.REGION_TYPE)),q[k]=o),f(a.PROP.BUTTON_IS_HOT)&&o.type===R&&(o.iconClass=e.getComponentIconClass(R,s(n.component,a.PROP.BUTTON_IS_HOT,!1)?"hot":"normal"),q[k]=o),f(a.PROP.GRID_NEW_GRID)&&(o.newGrid=h(a.PROP.GRID_NEW_GRID),r[l]=o),f(a.PROP.GRID_NEW_ROW)&&(o.newRow=h(a.PROP.GRID_NEW_ROW),r[l]=o),f(a.PROP.GRID_NEW_COLUMN)&&(o.newCol=h(a.PROP.GRID_NEW_COLUMN),r[l]=o),f(a.PROP.GRID_COLUMN)&&(o.col=1*g(a.PROP.GRID_COLUMN),r[l]=o),f(a.PROP.GRID_COLUMN_SPAN)&&(o.span=1*g(a.PROP.GRID_COLUMN_SPAN),r[l]=o),f(a.PROP.GRID_ROW_SPAN)&&(o.rowSpan=1*g(a.PROP.GRID_ROW_SPAN),r[l]=o),f(a.PROP.ITEM_DISPLAY_POSITION)&&(o.itemsAboveContent="ABOVE"===g(a.PROP.ITEM_DISPLAY_POSITION),r[l]=o),(f(a.PROP.ALIGNMENT)||f(a.PROP.BUTTON_POSITION)||f(a.PROP.REGION)||f(a.PROP.PARENT_REGION)||f(a.PROP.REGION_POSITION)||f(a.PROP.DISPLAY_SEQUENCE))&&(o._parent._parent.id!==l&&(w[o._parent._parent.id]=o._parent._parent),w[l]=p));for(k in q)q.hasOwnProperty(k)&&(o=q[k],r[o.id]||w[o.id]||i(r,o)||i(w,o)||F.gridlayout("update",o,!1));for(k in r)r.hasOwnProperty(k)&&(o=r[k],w[o.id]||i(r,o._parent._parent)||i(w,o)||F.gridlayout("update",o,!0));for(k in w)w.hasOwnProperty(k)&&(p=w[k],p&&!i(w,p)&&("page"===p.type?F.gridlayout("pageDataChanged"):(E(p),F.gridlayout("update",p,!0,!0))))},!0),a.observer(X,{events:[a.EVENT.GRID]},function(a){var b,d;if(c.getLevel()>=c.LOG_LEVEL.APP_TRACE&&c.trace("GLV Handle grid changes - refresh whole page: "+v(a)),!F.is(":visible"))for(y=[],d=F.gridlayout("getSelectedComponents"),b=0;b<d.length;b++)y.push(d[b].id);F.gridlayout("pageDataChanged")},!0),a.observer(X,{component:{typeIds:w},events:[a.EVENT.CREATE]},function(a){var b;return cb?void(cb=!1):(c.getLevel()>=c.LOG_LEVEL.APP_TRACE&&c.trace("GLV Handle create: "+v(a)),b=F.gridlayout("findComponentById",u(a.component)),void(b&&("page"===b.type?F.gridlayout("pageDataChanged"):(E(b),F.gridlayout("update",b,!0,!0)))))}),a.observer(X,{component:{typeIds:w},events:[a.EVENT.DELETE]},function(a){var b,d=a.component.id;ab||(c.getLevel()>=c.LOG_LEVEL.APP_TRACE&&c.trace("GLV Handle delete: "+v(a)),b=F.gridlayout("findById",d),b.length&&(bb=!0,F.gridlayout("remove",{},b)))}),a.observer(X,{component:{typeIds:w},events:[a.EVENT.ERRORS,a.EVENT.NO_ERRORS,a.EVENT.WARNINGS,a.EVENT.NO_WARNINGS]},function(a){var b=F.gridlayout("findComponentById",a.component.id);c.getLevel()>=c.LOG_LEVEL.APP_TRACE&&c.trace("GLV Handle error or warning status change: "+v(a)),b&&(b.hasErrors=a.component.hasErrors(),b.hasWarnings=a.component.hasWarnings(),F.gridlayout("update",b,!1))})}),b(document).on("modelReady",function(){$=!0;try{F.gridlayout("pageDataChanged")}catch(a){c.error("Failed to load grid layout",a),$=!1,F.gridlayout("pageDataChanged")}}),b(document).on("modelCleared",function(){$=!1,F.gridlayout("pageDataChanged")})}(pe,apex.jQuery,apex.debug,apex.lang,window.pageDesigner);