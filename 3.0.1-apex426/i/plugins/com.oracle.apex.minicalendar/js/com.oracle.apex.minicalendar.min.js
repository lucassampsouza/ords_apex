!function(util,server,$){com_oracle_apex_mini_calendar=function(pRegionId,pOptions){function _create(tag){return $(document.createElement(tag))}function _addDays(date,amount){return date=new Date(date.getTime()),date.setDate(date.getDate()+amount),date}function _addMonths(date,amount){return date=new Date(date.getTime()),date.setMonth(date.getMonth()+amount),date}function _truncateDate(date){return date=new Date(date.getTime()),date.setHours(0),date.setMinutes(0),date.setSeconds(0),date.setMilliseconds(0),date}function _truncateMonth(date){return date=new Date(date.getTime()),date.setDate(1),date}function _styleMonthSelector(){$(".a-MiniCalendar-monthSelector-month",gMonthSelector).each(function(){var e=$(this);e.removeClass("a-MiniCalendar-monthSelector-month--active"),e.data("month")==gCalendar.data("month")&&gMonthSelector.data("year")==gCalendar.data("year")&&e.addClass("a-MiniCalendar-monthSelector-month--active")}),$(".a-MiniCalendar-monthSelector-year",gMonthSelector).text(gMonthSelector.data("year"))}function _init(pRegionId,pOptions){gOptions=pOptions,gOptions.viewMode=gOptions.viewMode||"month",gRegion=$("#"+util.escapeCSS(pRegionId),apex.gPageContext$),gCalendar=$(".a-MiniCalendar",gRegion).empty().addClass("a-MiniCalendar--theme-"+gOptions.colorScheme).addClass("a-MiniCalendar--"+gOptions.viewMode).append(gCalendarMonth=_create("h3").addClass("a-MiniCalendar-monthTitle")).append(_create("table").addClass("a-MiniCalendar-month").append(_create("thead").append(gCalendarHeaderRow=_create("tr"))).append(gCalendarBody=_create("tbody")));for(var days=gDays,i=days.length-1;i>=0;i--)days[i].headerId=pRegionId+"_HEAD_"+days[i].id,gCalendarHeaderRow.prepend(_create("th").addClass("a-MiniCalendar-dayOfWeek").attr({scope:"col",id:days[i].headerId,title:days[i].name}).text(days[i]["short"]));if("month"==gOptions.viewMode&&gCalendarHeaderRow.prepend(_create("th").addClass("a-MiniCalendar-buttonColumn")).append(_create("th").addClass("a-MiniCalendar-buttonColumn")),gEventsContainer=_create("div").addClass("a-MiniCalendar-eventWrapper"),gCalendar.append(gEventsContainer),gEventsContainerTooltip=_create("div").addClass("a-MiniCalendar-eventWrapper a-MiniCalendar-eventWrapper--tooltip").hide(),gCalendar.append(gEventsContainerTooltip),gEventsContainerArrow=_create("div").addClass("a-MiniCalendar-eventWrapperArrow").hide(),gCalendar.append(gEventsContainerArrow),"FIRST"==gOptions.focusDate&&(gOptions.focusDate=null),gActiveDate=_truncateDate(gOptions.focusDate?_parseDate(gOptions.focusDate):new Date),gCalendar.data("year",gActiveDate.getFullYear()),gCalendar.data("month",gActiveDate.getMonth()),"month"==gOptions.viewMode){gMonthSelector=_create("div").addClass("a-MiniCalendar-monthSelector").append(_create("div").addClass("a-MiniCalendar-monthSelector-header").append(_create("a").addClass("a-MiniCalendar-monthSelector-year-control").html("&#9668;").attr("href","#").click(function(e){e.preventDefault();var s=gMonthSelector;s.data("year",s.data("year")-1),$(".a-MiniCalendar-monthSelector-year",s).text(s.data("year")),_styleMonthSelector()})).append(_create("div").addClass("a-MiniCalendar-monthSelector-year").text(gCalendar.data("year"))).append(_create("a").addClass("a-MiniCalendar-monthSelector-year-control").html("&#9658;").attr("href","#").click(function(e){e.preventDefault();var s=$(this).closest(".a-MiniCalendar-monthSelector");s.data("year",s.data("year")+1),$(".a-MiniCalendar-monthSelector-year",s).text(s.data("year")),_styleMonthSelector()}))),gMonthSelector.data("year",gActiveDate.getFullYear()),gMonthSelector.data("month",gActiveDate.getMonth());for(var row,i=0;4>i;i++){row=_create("div").addClass("a-MiniCalendar-monthSelector-row");for(var j=0;3>j;j++)row.append(_create("a").addClass("a-MiniCalendar-monthSelector-month").data("month",3*i+j).attr("href","#").click(function(e){e.preventDefault(),gCalendar.data("month",$(this).data("month")),gCalendar.data("year",gMonthSelector.data("year")),_renderMonth(),gMonthSelector.hide()}).text(gMonths[3*i+j]["short"].toUpperCase()));gMonthSelector.append(row)}gCalendar.append(gMonthSelector),gMonthSelector.hide()}("month"==gOptions.viewMode?_renderMonth:_renderYear)(gActiveDate),gOptions.showDateDetails&&_renderDateDetails(gActiveDate,gEventsContainer),gRegion.on("apexrefresh",_refresh).trigger("apexrefresh")}function _draw(pData){gData=pData.data,gOptions.focusDate||(gOptions.focusDate=new Date(gData[0].date||gData[0].startDate),gActiveDate=_parseDate(gOptions.focusDate),gCalendar.data("year",gActiveDate.getFullYear()),gCalendar.data("month",gActiveDate.getMonth())),("month"==gOptions.viewMode?_renderMonth:_renderYear)(gActiveDate),gOptions.showDateDetails&&_renderDateDetails(gActiveDate,gEventsContainer)}function _renderMonth(date){"undefined"==typeof date&&(date=new Date(gCalendar.data("year")+"-"+(gCalendar.data("month")+1)+"-1"));{var today=_truncateDate(new Date),monthStart=_truncateMonth(date),monthEnd=(_addDays(monthStart,-monthStart.getDay()),_addDays(_addMonths(monthStart,1),-1));_addDays(monthEnd,6-monthEnd.getDay())}gCalendar.empty().append(_create("div").addClass("a-MiniCalendar-header").append(_create("div").addClass("a-MiniCalendar-navBar").append(_create("button").addClass("a-MiniCalendar-button a-MiniCalendar-button--icon a-MiniCalendar-button--prev").attr("type","button").click(function(){var month=gCalendar.data("month"),yearOffset=0==month--?-1:0;-1==month&&(month=11),gCalendar.data("month",month),gCalendar.data("year",gCalendar.data("year")+yearOffset),_renderMonth()})).append(gCalendarMonth=_create("span").addClass("a-MiniCalendar-title").text(gMonths[monthStart.getMonth()].name+" "+monthStart.getFullYear())).append(_create("button").addClass("a-MiniCalendar-button a-MiniCalendar-button--today").attr("type","button").text("Today").click(function(){gActiveDate=today,gCalendar.data("month",today.getMonth()),gCalendar.data("year",today.getFullYear()),_renderMonth(today)})).append(_create("button").addClass("a-MiniCalendar-button a-MiniCalendar-button--icon a-MiniCalendar-button--next").attr("type","button").click(function(){var month=gCalendar.data("month"),yearOffset=11==month++?1:0;12==month&&(month=0),gCalendar.data("month",month),gCalendar.data("year",gCalendar.data("year")+yearOffset),_renderMonth()})))).append(_create("div").addClass("a-MiniCalendar-wrapper").append(_bindCellEvents(_monthCalendar(date.getMonth(),date.getFullYear())))),gEventsContainer=_create("div").addClass("a-MiniCalendar-eventWrapper"),gCalendar.append(gEventsContainer),gEventsContainerTooltip=_create("div").addClass("a-MiniCalendar-eventWrapper a-MiniCalendar-eventWrapper--tooltip").hide(),gCalendar.append(gEventsContainerTooltip),gEventsContainerArrow=_create("div").addClass("a-MiniCalendar-eventWrapperArrow").hide(),gCalendar.append(gEventsContainerArrow),gOptions.showDateDetails&&_renderDateDetails(gActiveDate,gEventsContainer),gMonthSelector=_create("div").addClass("a-MiniCalendar-monthSelector").append(_create("div").addClass("a-MiniCalendar-monthSelector-header").append(_create("a").addClass("a-MiniCalendar-monthSelector-year-control").html("&#9668;").attr("href","#").click(function(e){e.preventDefault();var s=gMonthSelector;s.data("year",s.data("year")-1),$(".a-MiniCalendar-monthSelector-year",s).text(s.data("year")),_styleMonthSelector()})).append(_create("div").addClass("a-MiniCalendar-monthSelector-year").text(gCalendar.data("year"))).append(_create("a").addClass("a-MiniCalendar-monthSelector-year-control").html("&#9658;").attr("href","#").click(function(e){e.preventDefault();var s=$(this).closest(".a-MiniCalendar-monthSelector");s.data("year",s.data("year")+1),$(".a-MiniCalendar-monthSelector-year",s).text(s.data("year")),_styleMonthSelector()}))),gMonthSelector.data("year",gActiveDate.getFullYear()),gMonthSelector.data("month",gActiveDate.getMonth());for(var row,i=0;4>i;i++){row=_create("div").addClass("a-MiniCalendar-monthSelector-row");for(var j=0;3>j;j++)row.append(_create("a").addClass("a-MiniCalendar-monthSelector-month").data("month",3*i+j).attr("href","#").click(function(e){e.preventDefault(),gCalendar.data("month",$(this).data("month")),gCalendar.data("year",gMonthSelector.data("year")),_renderMonth(),gMonthSelector.hide()}).text(gMonths[3*i+j]["short"].toUpperCase()));gMonthSelector.append(row)}gCalendar.append(gMonthSelector),gMonthSelector.hide()}function _bindCellEvents(calendar){return $(calendar).find("td.a-MiniCalendar-day").filter(function(i,e){return!!$(e).data("events")}).click(function(){gActiveDate=$(this).data("date"),$(".a-MiniCalendar-day.is-active",calendar).removeClass("is-active"),$(this).addClass("is-active"),gOptions.showDateDetails&&_renderDateDetails(gActiveDate,gEventsContainer)}).hover(function(){gOptions.showTooltips&&_renderDateDetails($(this).data("date"),gEventsContainerTooltip)&&(gEventsContainerTooltip.show().position({my:"center bottom",at:"center top-7",of:$(this),within:$(window),collision:"none"}).css({position:"absolute"}),gEventsContainerArrow.show().position({my:"center bottom",at:"center top-8",of:$(this),within:$(window),collision:"none"}).css({position:"absolute"}))},function(){gEventsContainerTooltip.hide(),gEventsContainerArrow.hide()}),calendar}function _renderYear(date){"undefined"==typeof date&&(date=new Date(gCalendar.data("year")+"-"+(gCalendar.data("month")+1)+"-1"));var y=date.getFullYear();gCalendar.empty().append(_create("div").addClass("a-MiniCalendar-year").text(y));for(var i=0;i<gMonths.length;i++)gCalendar.append(_create("div").addClass("a-MiniCalendar-monthContainer").append(_create("h3").addClass("a-MiniCalendar-monthTitle").text(gMonths[i].name)).append(_bindCellEvents(_monthCalendar(i,y))));gEventsContainer=_create("div").addClass("a-MiniCalendar-eventWrapper"),gCalendar.append(gEventsContainer),gEventsContainerTooltip=_create("div").addClass("a-MiniCalendar-eventWrapper a-MiniCalendar-eventWrapper--tooltip").hide(),gCalendar.append(gEventsContainerTooltip),gEventsContainerArrow=_create("div").addClass("a-MiniCalendar-eventWrapperArrow").hide(),gCalendar.append(gEventsContainerArrow)}function _monthCalendar(m,y){var calendar=_create("table").addClass("a-MiniCalendar-month"),calendarHeaders=_create("thead").appendTo(calendar);calendarHeaders=_create("tr").appendTo(calendarHeaders);for(var calendarBody=_create("tbody").appendTo(calendar),days=gDays,i=days.length-1;i>=0;i--)days[i].headerId=pRegionId+"_HEAD_"+days[i].id,calendarHeaders.prepend(_create("th").addClass("a-MiniCalendar-dayOfWeek").attr({scope:"col",id:days[i].headerId,title:days[i].name}).text(days[i]["short"]));var today=_truncateDate(new Date),monthStart=new Date;monthStart.setFullYear(y),monthStart.setMonth(m),monthStart.setDate(1),monthStart=_truncateDate(monthStart);var currentWeekRow,currentDateCell,currentEvents,calendarStart=_addDays(monthStart,-monthStart.getDay()),monthEnd=_addDays(_addMonths(monthStart,1),-1),calendarEnd=_addDays(monthEnd,6-monthEnd.getDay()),currentDate=calendarStart,weeks=0;do{calendarBody.append(currentWeekRow=_create("tr")),weeks++;for(var i=0;7>i;i++)currentWeekRow.append(currentDateCell=_create("td")),currentDateCell.addClass("a-MiniCalendar-day").attr("headers",gDays[currentDate.getDay()].headerId).data("date",currentDate).append(_create("div").addClass("a-MiniCalendar-date").text(currentDate.getDate())),currentDate.getMonth()!=monthStart.getMonth()?currentDateCell.addClass("is-null"):((0==currentDate.getDay()||6==currentDate.getDay())&&currentDateCell.addClass("is-weekend"),currentDate.valueOf()==gActiveDate.valueOf()&&currentDateCell.addClass("is-active"),currentDate.valueOf()==today.valueOf()&&currentDateCell.addClass("is-today"),currentEvents=_eventsOf(currentDate),currentEvents&&(currentDateCell.addClass("has-events"),currentDateCell.data("events",currentEvents))),currentDate=_addDays(currentDate,1)}while(calendarEnd>=currentDate);return calendar}function _eventsOf(date){date=_truncateDate(date);for(var currentStartDate,currentEndDate,events=[],i=gData.length-1;i>=0;i--)currentStartDate=_parseDate(gData[i].date||gData[i].startDate),currentEndDate=_parseDate(gData[i].endDate||gData[i].date),date>=currentStartDate&&currentEndDate>=date&&events.push(gData[i]);return 0==events.length?!1:events}function _parseDate(s){var r=new Date(s);return r.setFullYear(r.getUTCFullYear()),r.setMonth(r.getUTCMonth()),r.setDate(r.getUTCDate()),_truncateDate(r)}function _renderDateDetails(date,container){var events=_eventsOf(date);if(container.empty(),!events)return container.append(_create("div").addClass("a-MiniCalendar-eventDate").text(date.toLocaleDateString())).append(_create("div").addClass("a-MiniCalendar-noEventsMessage").text("No events found.")),!1;for(var i=events.length-1;i>=0;i--)container.prepend(_create("div").addClass("a-MiniCalendar-event").append(_create("div").addClass("a-MiniCalendar-eventName").append(_create("a").attr({href:events[i].link,target:"_blank"}).text(events[i].name))).append(_create("div").addClass("a-MiniCalendar-eventDescription").text(events[i].description)));return container.prepend(_create("div").addClass("a-MiniCalendar-eventDate").text(date.toLocaleDateString())),!0}function _clear(){}function _debug(){}function _refresh(){server.plugin(gOptions.ajaxIdentifier,{pageItems:gOptions.pageItems},{refreshObject:gRegion,clear:_clear,success:_draw,error:_debug,loadingIndicator:gCalendar,loadingIndicatorPosition:"append"})}var gOptions,gRegion,gCalendar,gCalendarBody,gCalendarMonth,gCalendarHeaderRow,gEventsContainer,gEventsContainerTooltip,gEventsContainerArrow,gMonthSelector,gActiveDate,gDays=[{name:"Sunday","short":"Sun",id:"SUN"},{name:"Monday","short":"Mon",id:"MON"},{name:"Tuesday","short":"Tue",id:"TUE"},{name:"Wednesday","short":"Wed",id:"WED"},{name:"Thursday","short":"Thu",id:"THU"},{name:"Friday","short":"Fri",id:"FRI"},{name:"Saturday","short":"Sat",id:"SAT"}],gMonths=[{name:"January","short":"Jan"},{name:"February","short":"Feb"},{name:"March","short":"Mar"},{name:"April","short":"Apr"},{name:"May","short":"May"},{name:"June","short":"Jun"},{name:"July","short":"Jul"},{name:"August","short":"Aug"},{name:"September","short":"Sep"},{name:"October","short":"Oct"},{name:"November","short":"Nov"},{name:"December","short":"Dec"}],gData=[];_init(pRegionId,pOptions)}}(apex.util,apex.server,apex.jQuery);