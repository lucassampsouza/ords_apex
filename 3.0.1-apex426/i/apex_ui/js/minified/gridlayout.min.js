!function(a,b,c,d,e){"use strict";function f(a,b,c){return a>b&&b+c>a}function g(a){return a.parent().children(":visible").index(a)}function h(a,b,c,d){var e,f;"string"!=typeof b&&(d=c,c=b,b="*"),e=a.children(b),f=e.index(c),f>=0&&d>f&&(d+=1),d>=e.length?a.append(c):e.eq(d).before(c)}function i(a){var b,c=a||"";return b=c.indexOf("_"),0>b?void 0:c.substring(b+1)}function j(a,b){var c;for(c=0;c<a.length;c++)if(a[c]===b)return c;return-1}function k(a){var b=0,c=a.parent();return c.children().each(function(){return this===a[0]?!1:void(b+=this.colSpan||1)}),b}function l(a,b,c,d){var e=b[c];e!==d&&(a.propertyChanges.push({component:b,property:c,oldValue:e,newValue:d}),b[c]=d)}function m(a,b,c,d){var e,f,g;if(0>c&&(c=0),d>0)for(g=Math.floor(c/d),0===g&&(g=1),e=b;e<a.length;e++)f=a[e],-1===f.span&&(f.span=g,c-=g,c>0&&g>c&&(f.span+=c))}function n(a,b){var c,d,e,f=b,g=0,h=0,i=0,j=1;for(c=0;c<a.columns.length;c++)e=a.columns[c],e.col>1&&(d=e.col-j,m(a.columns,g,d-h,i),f-=d,g=c,h=0,i=0,j=e.col),e.span>0?h+=e.span:i+=1;m(a.columns,g,f-h,i)}function o(a,b,c){var d;for(d in c)c.hasOwnProperty(d)&&b[d]&&(a+=" "+c[d]);return a}function p(a,b){var c;for(c in b)if(b.hasOwnProperty(c)&&a[c])return b[c];return null}function q(a,b){return a.types.indexOf(b)>=0}function r(a,b){var c,d="";for(c=0;c<a.length;c++)c>0&&(d+=" "),d+=qb[a[c]][b];return d}function s(a){var b="";return a.hasClass(P)&&(b+=",."+y),a.hasClass(O)&&(b+=",."+x),a.hasClass(Q)&&(b+=",."+z),b.substr(1)}function t(a){var b="",c=a.closest(_);return c.hasClass(A)&&(b+=" "+P),c.hasClass(C)&&(b+=" "+O),c.hasClass(E)&&(b+=" "+Q),b.substr(1)}var u="a-GridLayout",v="a-GridLayout-page",w=".a-GridLayout-page",x="a-GridLayout-pageItem",y="a-GridLayout-region",z="a-GridLayout-button",A="a-GridLayout-regionContainer",B=".a-GridLayout-regionContainer",C="a-GridLayout-itemContainer",D=".a-GridLayout-itemContainer",E="a-GridLayout-buttonContainer",F=".a-GridLayout-buttonContainer",G="a-GridLayout-regionContent",H="a-GridLayout-buttonGroup",I=".a-GridLayout-buttonGroup,.a-GridLayout-regionContent",J="a-GridLayout-buttonRow",K=".a-GridLayout-buttonRow",L="a-GridLayout--conditional",M="a-GridLayout--legacy",N=".a-GridLayout--legacy",O="a-GridLayout-items",P="a-GridLayout-regions",Q="a-GridLayout-buttons",R="a-GridLayout-grid",S=".a-GridLayout-grid",T="a-GridLayout-stack",U="a-GridLayout-flow",V="a-GridLayout-label",W=".a-GridLayout-label",X="a-GridLayout-dragAction",Y=".a-GridLayout-dragAction",Z=".a-GridLayout-pageItem, .a-GridLayout-region, .a-GridLayout-button",$=".a-GridLayout-page, .a-GridLayout-pageItem, .a-GridLayout-region, .a-GridLayout-button",_=".a-GridLayout-regionContainer, .a-GridLayout-itemContainer, .a-GridLayout-buttonContainer",ab=".a-GridLayout-grid, .a-GridLayout-stack, .a-GridLayout-flow",bb="a-GridLayout-templateGrid",cb="is-disabled",db="is-focused",eb=".is-selected",fb="is-selected",gb="is-active",hb="a-GridLayout-helper",ib="a-GridLayout-placeholder",jb="a-GIcon",kb="is-draggable",lb=".is-draggable",mb="aria-selected",nb=-1,ob=-2,pb=-3,qb={regionContainer:[A,P],itemContainer:[C,O],buttonContainer:[E,Q]},rb={region:y,item:x,button:z},sb=[50,75,100,125,150,175,200];a.widget("apex.gridlayout",a.ui.mouse,{version:"5.0",widgetEventPrefix:"gridlayout",dragging:!1,animating:!1,nodeMap:{},nextId:1,dragComponent:null,helper:null,fromOutside:!1,isOver:!1,lastZoom:"",pageRoot:null,options:{getPageRoot:null,getIconForComponent:function(a){var b="",c=a.type;return"region"===c?b="region":"item"===c?b="page-item":"button"===c?b="button":"page"===c&&(b="page"),b},makeComponent:null,updateComponentCopy:null,deleteKeyAction:null,contextMenuAction:null,stateClassMap:{},stateIconMap:{},displayFrom:null,hideLegacyDisplayPoints:!1,hideEmptyDisplayPoints:!1,hideButtons:!1,hideItems:!1,zoom:100,iconType:jb,appendTo:"parent",containment:!1,cursor:"auto",cursorAt:!1,gridTolerance:10,idPrefix:null,multiple:!0,opacity:!1,animate:!0,scroll:!0,scrollSensitivity:20,scrollSpeed:20,tolerance:"intersect",zIndex:1e3,activate:null,deactivate:null,out:null,over:null,start:null,beforeStop:null,stop:null,selectionChange:null,added:null,removed:null,moved:null,copied:null},_create:function(){var b=this.options,c=this;if(!b.makeComponent||!b.updateComponentCopy||!b.getPageRoot)throw"Missing required options.";this.pageRoot=b.getPageRoot(),this.containerCache={},this.element.addClass(u),this.baseId=(b.idPrefix||this.element[0].id||"glv")+"_",this.refresh(!1),this._setZoom(),this.offset=this.element.offset(),this._mouseInit(),this.element.on("keydown.glv",function(d){var e=a.ui.keyCode,f=d.which;d.altKey||(f===e.HOME?(c._select(a(w+":first"),d,!0,!0),d.preventDefault()):f===e.END?(c._select(c.element.find($).last(),d,!0,!0),d.preventDefault()):f===e.DOWN?(c._traverseDown(d),d.preventDefault()):f===e.UP?(c._traverseUp(d),d.preventDefault(),d.stopPropagation()):f===e.LEFT?(c._traverseLeft(d),d.preventDefault()):f===e.RIGHT?(c._traverseRight(d),d.preventDefault()):f===e.SPACE?(c.lastFocused&&c._select(a(c.lastFocused),d,!0,!0),d.preventDefault()):b.deleteKeyAction&&f===e.DELETE?(c.lastFocused&&b.deleteKeyAction(d),d.preventDefault()):b.contextMenuAction&&d.shiftKey&&121===f&&(c.lastFocused&&!a(c.lastFocused).is(eb)&&c._select(a(c.lastFocused),{},!1,!0),b.contextMenuAction(d),d.preventDefault()))}).on("focusin",function(b){var d=a(b.target).closest($);0!==d.length&&(d.addClass(db),c._setFocusable(d[0]))}).on("focusout",function(b){var c=a(b.target).closest($);c.removeClass(db)}).on("contextmenu",function(d){var e;b.contextMenuAction&&(e=a(d.target).closest($).not(eb),e.length&&c._select(e,{},!1,!1),b.contextMenuAction(d),d.preventDefault())})},_destroy:function(){return this.element.removeClass(u).empty(),this._mouseDestroy(),this},_setOption:function(b,c){"disabled"===b?(this.options[b]=c,this.widget().toggleClass(cb,!!c)):a.Widget.prototype._setOption.apply(this,arguments),"displayFrom"===b?this.refresh(!1):"hideLegacyDisplayPoints"===b||"hideButtons"===b||"hideItems"===b||"hideEmptyDisplayPoints"===b?this._showOrHideDisplayPoints():"zoom"===b&&this._setZoom()},pageDataChanged:function(){var a=this.options;this.pageRoot=this.options.getPageRoot(),a.displayFrom&&(this._find(a.displayFrom,!0)||(a.displayFrom=null)),this.refresh(!1)},getPageData:function(){return this.pageRoot},refresh:function(a){var d,e,f,g,h,i,j,k=this.options,l=b.htmlBuilder();if(c.info("Gridlayout refresh"),!a)for(h=[],g=this.getSelectedComponents(),d=0;d<g.length;d++)h.push(g[d].id);if(this._layoutPage(),this.nodeMap={},k.displayFrom){if(e=this._find(k.displayFrom,!0),!e)throw"No such region in displayFrom option: "+k.displayFrom;for(i=!0,j=e._parent;j;){if(j.components&&!j.isGrid){i=!1;break}j=j._parent}this._renderRegion(l,e,i,!0)}else this._renderPage(l,this.pageRoot);return this.element.html(l.toString()),this._showOrHideDisplayPoints(),f=this.element.children().eq(0),a?(this._select(f,a),this._trigger("selectionChange")):(this._setFocusable(f[0]),h.length>0&&this.element.is(":visible")&&(this.setSelectedComponents(h,!1),h.length!==this.getSelection().length&&this._trigger("selectionChange"))),this},dump:function(){c.log("Page: \r\n"+JSON.stringify(this.pageRoot,function(a,b){return"_parent"===a?"-> "+(this._parent.id||this._parent.title):"_modelComponent"===a?"[id="+b.id+"]":"_parentGrid"===a?"-> "+j(this._parentGrid._parent._grids,this._parentGrid):"_parentRow"===a?"-> "+j(this._parentRow._parentGrid.rows,this._parentRow):"_parentColumn"===a?"-> "+j(this._parentColumn._parentRow.columns,this._parentColumn):b},2))},findById:function(b){var c=this._find(b);return c?this._getElement(c):a()},findComponentById:function(a){return this._find(a)},getContainer:function(a){return a.closest(_)},findContainer:function(a,b){var c,d,e,f=this.pageRoot;if(d=f.id===a?f:this._find(a,!0))for(c=0;c<d.displayPoints.length;c++)if(e=d.displayPoints[c],e.id===b)return e;return null},getComponents:function(a){var b=this,c=[];return a.each(function(){c.push(b._getNode(this))}),c},getSelection:function(){return this.element.find(eb)},getSelectedComponents:function(){return this.getComponents(this.getSelection())},setSelection:function(a,b){b=!!b,this._select(a,null,b,!1,!0)},setSelectedComponents:function(b,c){var d,e,f,g=[];for(c=!!c,d=0;d<b.length;d++)e=this._find(b[d]),e&&(f=this._getElement(e),f.length>0&&g.push(f[0]));this._select(a(g),null,c,!1,!0)},focus:function(){this.lastFocused&&this.lastFocused.focus()},makeHelper:function(c,d,e,f){var g,h,i=this.options.getIconForComponent,j=new b.htmlBuilder;return c||(g=this._getNode(this.dragComponent[0]),c=g.type,d=i(g),e=g.title),h=rb[c]+" "+hb,j.markup("<div").attr("class",h).optionalAttr("data-type-id",f).markup(">"),this._renderHeader(j,d,e,!0),j.markup("<div").attr("class",X).markup("></div></div>"),a(j.toString())},getDropTargets:function(b,c){function e(c){i=c,a(this).children().eq(0).children(k).each(function(c){return n&&this===b[0]?void(m=!0):void g.items.push({element:a(this),row:h,col:i,index:c,name:a(this).children("h3").text()})})}function f(b){h=b,a(this).children("td").each(e)}var g,h,i,j,k,l,m,n,o,p=[];if(c=c||"move",n="move"===c,"add"===c&&"string"==typeof b&&(o=b),"item"===o||!o&&b.hasClass(x))j=O;else if("region"===o||!o&&b.hasClass(y))j=P;else{if("button"!==o&&(o||!b.hasClass(z)))throw"Invalid component or component type";j=Q}return j="."+j,k="."+k,l=a(j,this.element).filter(":visible"),l.each(function(){var c,e,h,i,j,l=a(this),o=null;k=s(l),l.hasClass(R)?e="grid":l.hasClass(T)?e="stack":l.hasClass(U)&&(e="flow"),("stack"!==e||"TD"!==l.parent()[0].nodeName)&&(n&&0!==l.parents().filter(b[0]).length||(i=l.parent().closest(".a-GridLayout-region").find(".a-GridLayout-label").eq(0).text(),j="",""!==i&&(j=i+" > "),"flow"===e&&"TD"===l.parent()[0].nodeName?(h=l.closest(K).prev().text(),l.parent().next().length>0?(h=d.formatMessageNoEscape("GL.BTN_POS_L",h),o="left"):(h=d.formatMessageNoEscape("GL.BTN_POS_R",h),o="right")):h=l.prev().text(),j+=h,g={element:l.closest(_),type:e,region:i,name:h,label:j},m=!1,"grid"===e?(g.items=[],l.children("tbody").children("tr").each(f)):(g.items=[],o&&(g.alignment=o),l.children(k).each(function(d){return n&&this===b[0]?void(m=!0):(c={element:a(this),index:d,name:a(this).children("h3").text()},o&&(c.alignment=o),void g.items.push(c))})),m&&0===g.items.length||p.push(g)))}),p},update:function(d,e,f){var g,h,i,j,k,l,m=this.options,n=!1;if("string"==typeof d&&(d=this._find(d)),!d)throw"Nothing to update";if(c.getLevel()>=c.LOG_LEVEL.INFO&&c.info("Gridlayout update component: "+d.title+", layoutChange: "+e+", childrenOnly: "+f),e&&((!f||d._parent)&&(d=d._parent._parent),n="page"===d.type?!0:a.isArray(d._parent._grids),this._layoutDisplayPoints(d.displayPoints,d,n,12)),i=this._getElement(d),i.length)if(e)k=this.getSelectedComponents(),h=b.htmlBuilder(),"page"===d.type?this._renderPage(h,d):this._renderComponent(h,d,n),j=a(h.toString()),i.hasClass(fb)&&j.addClass(fb),j[0].tabIndex=i[0].tabIndex,i.replaceWith(j),this._showOrHideDisplayPoints(j),this.setSelectedComponents(k);else{i.find(W).first().html(b.escapeHTML(d.title)),i.toggleClass(L,!!d.isConditional);for(g in m.stateClassMap)m.stateClassMap.hasOwnProperty(g)&&i.toggleClass(m.stateClassMap[g],!!d[g]);i.find("."+m.iconType)[0].className=m.iconType+" "+m.getIconForComponent(d),l=p(d,m.stateIconMap),l&&i.find(W).first().prepend("<span class='a-Icon "+l+"'></span>")}},add:function(a,b,d,e,f,g,h,i,j){var k,l,m;if(("string"==typeof b||"number"==typeof b)&&(l=b,b=this.options.makeComponent(l)),d=this._getContainerElement(d),!d||!d.is(_))throw"Invalid add destination";return c.getLevel()>=c.LOG_LEVEL.INFO&&c.info("Gridlayout add component: "+b.title+" to: "+d[0].id+", g/r/c/i: "+e+"/"+f+"/"+g+"/"+h),k=this._add(b,d,e,f,g,h,i,j),m=k.newComponent$,k.lastChange=!0,this._trigger("added",a,k),this._select(m,a,!0),this},remove:function(b,d){var e,f,g,h,i,j=[],k=a(this.lastFocused).hasClass(db),l=this;if(c.getLevel()>=c.LOG_LEVEL.INFO&&c.info("Gridlayout remove "+(d?d.length+" component(s).":"selection")),d=d||this.getSelection(),a.isArray(d)){for(h=[],e=0;e<d.length;e++)i=this.findById(d[e]),i.length>0&&h.push(i[0]);d=a(h)}if(!d||0===d.filter(Z).length)throw"Nothing to remove";for(g=d.filter(eb).eq(0);g&&g.length&&g.hasClass(fb)&&!g.is(w);)g=a(this._traverseUp(b,!0)),g&&(this.lastFocused=g[0]);for(d.filter(Z).each(function(){var b;b=l._getNode(this),b&&(c.info("Gridlayout remove component: "+b.title),f=l._remove(a(this)),j.push(f))}),e=0;e<j.length;e++)j[e].lastChange=e>=j.length-1,l._trigger("removed",b,j[e]);return g&&g.length&&this._select(g,b,k),this},move:function(b,d,e,f,g,h,i,j){var k,l;if(d=d||a(this.lastFocused),d=this._getComponentElement(d),!d||!d.is(Z))throw"Nothing to move";if(e=this._getContainerElement(e),!e||!e.is(_))throw"Invalid move destination";return c.getLevel()>=c.LOG_LEVEL.INFO&&c.info("Gridlayout move component: "+this._getNode(d[0]).title+" to: "+e[0].id+", g/r/c/i: "+f+"/"+g+"/"+h+"/"+i),k=this._moveOrCopy(d,e,f,g,h,i,j,!1),l=k.newComponent$,k.lastChange=!0,this._trigger("moved",b,k),this._select(l,b,!0),this},copy:function(b,d,e,f,g,h,i,j){var k,l;if(d=d||a(this.lastFocused),d=this._getComponentElement(d),!d||!d.is(Z))throw"Nothing to copy";if(e=this._getContainerElement(e),!e||!e.is(_))throw"Invalid copy destination";return c.getLevel()>=c.LOG_LEVEL.INFO&&c.info("Gridlayout copy component: "+this._getNode(d[0]).title+" to: "+e[0].id+", g/r/c/i: "+f+"/"+g+"/"+h+"/"+i),k=this._moveOrCopy(d,e,f,g,h,i,j,!0),l=k.newComponent$,k.lastChange=!0,this._trigger("copied",b,k),this._select(l,b,!0),this},_layoutGrid:function(a,b,c,d){function e(a,b){var c=s.columns.splice(a,1);s.columns.splice(b,0,c[0])}var f,g,h,i,j,k,l,m=this.pageRoot,o=null,p={},q=0,r=null,s=null,t=null,u=0;if(c)for(o=[],i=0;i<a.length;i++)if(j=a[i],(!r||c&&"fixed"!==m.gridType&&j.newGrid)&&(r={_parent:b,rows:[]},s=null,o.push(r)),(!s||c&&j.newRow)&&(s={_parentGrid:r,columns:[]},t=null,r.rows.push(s),p={}),c&&j.col>0)if(p.hasOwnProperty(j.col))s.columns[p[j.col]].components.push(j),j._parentColumn=s.columns[p[j.col]];else if(t={_parentRow:s,col:j.col,span:m.hasColumnSpan?j.span||-1:1,rowSpan:j.rowSpan,components:[j]},j._parentColumn=t,s.columns.push(t),u=s.columns.length-1,j.col<q){for(l=u,k=j.col+1;q>=k;k++)p.hasOwnProperty(k)&&(p[k]<l&&(l=p[k]),p[k]+=1);l!==u&&e(u,l),p[j.col]=l}else q=j.col,p[j.col]=u;else(!t||c&&j.newCol)&&(t={_parentRow:s,col:-1,span:m.hasColumnSpan?j.span||-1:1,rowSpan:j.rowSpan,components:[]},s.columns.push(t)),t.components.push(j),j._parentColumn=t;if(c&&"fixed"===m.gridType&&m.hasColumnSpan)for(f=0;f<o.length;f++)for(r=o[f],g=0;g<r.rows.length;g++)s=r.rows[g],n(s,d);if(o)for(f=0;f<o.length;f++)for(r=o[f],g=0;g<r.rows.length;g++)for(s=r.rows[g],h=0;h<s.columns.length;h++)t=s.columns[h];for(i=0;i<a.length;i++)j=a[i],j._parent=b,j.displayPoints&&this._layoutDisplayPoints(j.displayPoints,j,c,d);return o},_layoutDisplayPoints:function(a,b,c,d){var e,f,g=this.pageRoot,h=0;for(e=0;e<a.length;e++){if(f=a[e],f._parent=b,f.hasOwnProperty("span")||f.hasOwnProperty("newColumn")){if(f.newGrid===!0&&(delete f.newRow,delete f.newColumn),f.newRow===!0&&delete f.newColumn,(f.newRow===!0||f.newGrid===!0)&&(h=0),f.span=f.span||1,f.newColumn!==!1&&(h+=f.span),"fixed"===g.gridType&&h>d)throw"Fixed layout template grid exceeded max columns. Display point: "+f.title;if(c&&f.isGrid&&!f.maxColumns&&(f.maxColumns="fixed"!==g.gridType||g.alwaysUseMaxColumns?d:f.span),f.isGrid&&"fixed"===g.gridType&&!g.alwaysUseMaxColumns&&f.span!==f.maxColumns)throw"Fixed layout span and maxColumns must be the same. Display point: "+f.title}else h=0,c&&f.isGrid&&!f.maxColumns&&(f.maxColumns=d);if(f.hasRowSpan&&!g.hasRowSpan)throw"Row span not allowed for display point when page doesn't support row span. Display point: "+f.title;f._grids=this._layoutGrid(f.components,f,c&&f.isGrid,f.maxColumns||d)}},_layoutPage:function(){var a=this.pageRoot;this._layoutDisplayPoints(a.displayPoints,a,!0,a.maxColumns)},_showOrHideDisplayPoints:function(b){var c,d=this.options,e=this;b=b||this.element,b.find(B).each(function(){var b=e._getNode(this);a(this).toggle(!d.hideEmptyDisplayPoints&&a(this).is(N)?!d.hideLegacyDisplayPoints||0!==b.components.length:!d.hideEmptyDisplayPoints||0!==b.components.length)}),b.find(F).each(function(){var b=e._getNode(this);c=!(d.hideButtons||d.hideEmptyDisplayPoints&&0===b.components.length),c&&b.isLegacy&&(c=!d.hideLegacyDisplayPoints||0!==b.components.length),a(this).toggle(c)}),b.find(D).each(function(){var b=e._getNode(this);c=!(d.hideItems||d.hideEmptyDisplayPoints&&0===b.components.length),c&&b.isLegacy&&(c=!d.hideLegacyDisplayPoints||0!==b.components.length),a(this).toggle(c)}),d.hideEmptyDisplayPoints},_find:function(a,b){function c(d){var e,f,g,h,i=null;for(e=0;e<d.length;e++)if(g=d[e],!b||q(g,"regionContainer"))for(f=0;f<g.components.length;f++){if(h=g.components[f],h===a||h.id===a)return h;if(h.displayPoints&&(i=c(h.displayPoints)))return i}return i}var d=this.pageRoot;return!b&&d===a||d.id===a?d:c(d.displayPoints)},_getComponentElement:function(a){return"string"==typeof a?this.findById(a):a._elementId?this._getElement(a):a},_getContainerElement:function(b){var c;return a.isArray(b)?(c=this.findContainer(b[0],b[1]),c?this._getElement(c):null):b._elementId?this._getElement(b):b},_addNode:function(a){var b=this.nextId;return this.nodeMap[this.nextId]=a,a._elementId=this.nextId,this.nextId+=1,this.baseId+b},_setNode:function(a){if(!a._elementId)throw"Failed to add node to nodeMap - no id";this.nodeMap[a._elementId]=a},_getNode:function(a){var b=i(a.id);return this.nodeMap[b]},_getElement:function(b){var c=this.baseId+b._elementId;return a("#"+c)},_renderHeader:function(a,b,c,d,e){a.markup("<h3").optionalAttr("class",null!==d?kb:null).optionalAttr("aria-grabbed",null!==d?""+d:null).markup("><span").attr("class",this.options.iconType+" "+b).markup("></span><span").attr("class",V).markup(">"),e&&a.markup("<span class='a-Icon ").attr(e).markup("'></span>"),a.content(c).markup("</span></h3>")},_renderRegion:function(a,b,c,d){var e,f=y;b.isConditional&&(f+=" "+L),f=o(f,b,this.options.stateClassMap),e=p(b,this.options.stateIconMap),a.markup("<div").attr("class",f).attr("id",this._addNode(b)).markup(" tabindex='-1'>"),this._renderHeader(a,this.options.getIconForComponent(b),b.title,d||b.isReadOnly?null:!1,e),this._renderDisplayPoints(a,b.displayPoints,c,b.itemsAboveContent),a.markup("</div>")},_renderItem:function(a,b){var c,d=x;b.isConditional&&(d+=" "+L),d=o(d,b,this.options.stateClassMap),c=p(b,this.options.stateIconMap),a.markup("<div").attr("class",d).attr("id",this._addNode(b)).markup(" tabindex='-1'>"),this._renderHeader(a,this.options.getIconForComponent(b),b.title,b.isReadOnly?null:!1,c),a.markup("</div>")},_renderButton:function(a,b){var c,d=z;b.isConditional&&(d+=" "+L),d=o(d,b,this.options.stateClassMap),c=p(b,this.options.stateIconMap),a.markup("<div").attr("class",d).attr("id",this._addNode(b)).markup(" tabindex='-1'>"),this._renderHeader(a,this.options.getIconForComponent(b),b.title,b.isReadOnly?null:!1,c),a.markup("</div>")},_renderComponentsInGrid:function(a,b,c,d){function e(){for(a.markup("<thead><tr>"),f=0;f<b.maxColumns;f++)a.markup("<td></td>");a.markup("</tr></thead>")}var f,g,h,i,j,k,l,m,n,o,p=this.pageRoot.gridType;if(d.length>0)for(g=0;g<d.length;g++){for(m=d[g],a.markup("<table").attr("class",R+" "+c+(0===g?" first":"")).markup(">"),"fixed"===p&&e(),a.markup("<tbody>"),h=0;h<m.rows.length;h++){for(n=m.rows[h],a.markup("<tr>"),l=1,i=0;i<n.columns.length;i++){for(o=n.columns[i],o.col>l&&(a.markup("<td").attr("colspan",o.col-l).markup("><div").attr("class",T+" "+c).markup("></div></td>"),l=o.col),l+=o.span>0?o.span:1,a.markup("<td").optionalAttr("colspan",o.span).optionalAttr("rowspan",o.rowSpan).markup("><div").attr("class",T+" "+c).markup(">"),j=0;j<o.components.length;j++)k=o.components[j],this._renderComponent(a,k,!0);a.markup("</div></td>")}a.markup("</tr>")}a.markup("</tbody></table>")}else a.markup("<table").attr("class",R+" first "+c).markup(">"),"fixed"===p&&e(),a.markup("<tbody><tr><td><div").attr("class",T+" "+c).markup("></div></td></tr></tbody></table>")},_renderComponent:function(a,b,c){if("region"===b.type)this._renderRegion(a,b,c);else if("item"===b.type)this._renderItem(a,b);else{if("button"!==b.type)throw"Unknown component type";this._renderButton(a,b)}},_renderComponents:function(a,b,c,d){var e,f;if(a.markup("<div").attr("class",b).markup(">"),c&&c.length>0)for(e=0;e<c.length;e++)f=c[e],d&&f.alignment!==d||this._renderComponent(a,f,!1);a.markup("</div>")},_renderDisplayPoints:function(a,b,c,e){function f(){var b;k=d.getMessage("GL.REGION_CONTENT"),a.markup("<div").attr("class",G).markup("><h3>").content(k).markup("</h3>"),m&&(b=m.types[0],a.markup("<div").attr("class",qb[b][0]).attr("id",l._addNode(m)).markup(">"),a.markup("<h3>").content(m.title).markup("</h3>"),l._renderComponents(a,U+" "+qb[b][1],m.components),a.markup("</div>")),a.markup("</div>")}var g,h,i,j,k,l=this,m=null,n=!1,o=!1,p=!1;for(g=0;g<b.length;g++){if(h=b[g],h.hasOwnProperty("span")||h.hasOwnProperty("newColumn")?(p&&h.newColumn!==!1&&(a.markup("</td>"),p=!1),o?h.newGrid===!0&&a.markup("</tr></tbody></table><table").attr("class",bb).markup("><tbody><tr>"):(a.markup("<table").attr("class",bb).markup("><tbody><tr>"),o=!0,h.newColumn=!0),h.newRow===!0&&a.markup("</tr><tr>"),h.newColumn!==!1&&(a.markup("<td colspan='"+h.span+"'>"),p=!0)):o&&(a.markup("</tr></tbody></table>"),o=!1),h.types.length>1||q(h,"regionContainer")||q(h,"itemContainer"))n&&(a.markup("</div>"),n=!1);else if("buttonContainer"===h.types[0]){if("RIGHT_OF_IR_SEARCH_BAR"===h.id){m=h;continue}n?h.hasAlignment&&(a.markup("</div>"),n=!1):h.hasAlignment||(a.markup("<div").attr("class",H).markup(">"),n=!0)}if(q(h,"itemContainer")&&"BODY"===h.id&&!e&&f(),i=r(h.types,0),h.isLegacy&&(i+=" "+M),j=r(h.types,1),a.markup("<div").attr("class",i).attr("id",this._addNode(h)).markup(">"),a.markup("<h3>").content(h.title).markup("</h3>"),h.types.length>1||q(h,"regionContainer")||q(h,"itemContainer"))h.isGrid&&c?this._renderComponentsInGrid(a,h,j,h._grids):this._renderComponents(a,T+" "+j,h.components);else{if("buttonContainer"!==h.types[0])throw"Unknown display point type: "+h.types[0];h.hasAlignment?(a.markup("<table").attr("class",J).markup("><tbody><tr><td>"),this._renderComponents(a,U+" "+j,h.components,"left"),a.markup("</td><td>"),this._renderComponents(a,U+" "+j,h.components,"right"),a.markup("</td></tr></tbody></table>")):this._renderComponents(a,U+" "+j,h.components)}a.markup("</div>"),q(h,"itemContainer")&&"BODY"===h.id&&e&&f()}n&&a.markup("</div>"),o&&a.markup("</tr></tbody></table>")},_renderPage:function(a,b){var c,d=v;b.isConditional&&(d+=" "+L),d=o(d,b,this.options.stateClassMap),c=p(b,this.options.stateIconMap),a.markup("<div").attr("class",d).attr("id",this._addNode(b)).markup(" tabindex='-1'>"),this._renderHeader(a,this.options.getIconForComponent(b),b.title,null,c),this._renderDisplayPoints(a,b.displayPoints,!0),a.markup("</div>")},_setFocusable:function(a){this.lastFocused&&this.lastFocused!==a&&(this.lastFocused.tabIndex=-1),a.tabIndex=0,this.lastFocused=a},_select:function(b,c,d,e,f){var g,h,i,j,k,l,m="set",n=this;b=b.filter(":visible"),c&&this.options.multiple&&("mousedown"===c.type?c.ctrlKey||c.metaKey?m="toggle":c.shiftKey&&(m="add"):"keydown"===c.type&&(c.keyCode===a.ui.keyCode.SPACE?m="toggle":c.ctrlKey?m="none":c.shiftKey&&(m="add"))),g=this.element.find(eb),"set"===m&&g.removeClass(fb).removeAttr(mb),h=b.hasClass(fb),"set"===m||"add"===m||"toggle"===m&&!h?b.addClass(fb).attr(mb,!0):"toggle"===m&&h&&b.removeClass(fb).removeAttr(mb),b.length>0&&(d?(b[0].tabIndex=0,b[0].focus()):this._setFocusable(b[0]),j=this.element.scrollParent(),k=j.offset(),k&&(l=this.element.offset(),i=b.first().offset(),(i.top<k.top||i.top>k.top+j[0].offsetHeight)&&(j[0].scrollTop=i.top-l.top),(i.left+b[0].offsetWidth<k.left||i.left>k.left+j[0].offsetWidth)&&(j[0].scrollLeft=i.left-l.left))),f||("toggle"===m||"add"===m&&!h||"set"===m&&(g[0]!==b[0]||g.length!==b.length))&&(n.triggerTimerId&&(clearTimeout(n.triggerTimerId),n.triggerTimerId=null),n.triggerTimerId=setTimeout(function(){n.triggerTimerId=null,n._trigger("selectionChange",c)},e?350:1))},_traverseRight:function(b){var c,d,e=null;if(this.lastFocused){if(c=a(this.lastFocused),c.parent().hasClass(U))return void this._traverseDown(b);for(d=c.closest("td");d.length;){if(c=d.next().find(Z).first(),c.length){e=c;break}d=d.parent().closest("td")}e&&e.length>0&&this._select(e.eq(0),b,!0,!0)}},_traverseLeft:function(b){var c,d,e=null;if(this.lastFocused){if(c=a(this.lastFocused),c.parent().hasClass(U))return void this._traverseUp(b);for(d=c.closest("td");d.length;){if(c=d.prev().find(Z).first(),c.length){e=c;break}d=d.parent().closest("td")}e&&e.length>0&&this._select(e.eq(0),b,!0,!0)}},_traverseDown:function(b){var c,d,e,f,g,h,i;if(this.lastFocused){if(e=a(this.lastFocused),b.which!==a.ui.keyCode.RIGHT&&(i=e.closest(I),0===i.length&&(i=e.closest("."+E)),i.length>0&&(e=i.find(Z).last())),f=e.find(Z).filter(":visible").first(),f.length>0)e=f;else if(f=e.nextAll(":visible").first(),f.length>0)e=f;else if(e.closest(K).length>0&&(f=e.closest("td").next().find(Z).filter(":visible").first()),f.length>0)e=f;else for(;e.length>0;){if(f=e.nextAll(Z).filter(":visible").first(),f.length>0){e=f;break}if(f=e.nextAll(":visible").find(Z).filter(":visible").first(),f.length>0){e=f;break}if(g=e.parent().parent().parent("tr").first().next().first(),g.length>0&&(h=g.prev()[0],c=k(e.parents("td").filter(function(){return this.parentNode===h})),d=0,g.children().each(function(){return d+=this.colSpan||1,d>c?(f=a(this).find(Z).first(),!1):void 0}),0===f.length&&(f=g.children().last().find(Z).first())),f.length>0){e=f;break}e=e.parent().closest(Z+","+_+","+I)}e&&e.length>0&&this._select(e,b,!0,!0)}},_traverseUp:function(b,c){var d,e,f,g,h,i,j;if(this.lastFocused&&(f=a(this.lastFocused),b.which!==a.ui.keyCode.LEFT&&(j=f.closest(I),0===j.length&&(j=f.closest("."+E)),j.length>0&&(f=j.find(Z).first())),g=f.prevAll(":visible").first(),g.length>0?(f=g.find(Z).filter(":visible").last(),0===f.length&&(f=g)):(h=f.closest("tr").prev(),h.length>0&&(d=k(f.closest("td")),e=0,h.children().each(function(){return e+=this.colSpan||1,e>d?(g=a(this).find(Z).filter(":visible").last(),!1):void 0}),0===g.length&&(g=h.children().last().find(Z).filter(":visible").last())),g.length>0?f=g:(f.closest(K).length>0&&(g=f.closest("td").prev().find(Z).filter(":visible").last()),0===g.length&&(i=j&&j.length>0?j:f.parent().closest(_),g=i.prevAll(":visible").find(Z).filter(":visible").last(),0===g.length&&i.parent().is(I)&&(i=i.parent(),g=i.prevAll(":visible").find(Z).filter(":visible").last())),f=0===g.length?f.parent().closest($):g)),f&&f.length>0)){if(c)return f[0];this._select(f,b,!0,!0)}},_setZoom:function(){var a,b,c=1*this.options.zoom;for(a=0;a<sb.length;a++)if(c<=sb[a]){c=sb[a];break}a>=sb.length&&(c=sb[sb.length-1]),b=u+"--z"+c,this.element.removeClass(this.lastZoom).addClass(b),this.lastZoom=b},_mouseCapture:function(b,c){var d,e=null,f=this;return this.animating||this.options.disabled?!1:("H3"===b.target.nodeName?d=a(b.target):"H3"===b.target.parentNode.nodeName&&(d=a(b.target.parentNode)),d&&d.length&&(e=d.parent($)),e&&e.length&&!c&&f._select(e,b,!0,!1),d&&d.length&&(e=d.parent(Z)),d&&d.is(lb)&&e&&1===e.length&&!e.parent().hasClass(u)?(this.dragComponent=e,this._initDragTargets(this.dragComponent),!0):!1)},_mouseStart:function(b,c,d){var e,f,g,h=this.options,i=this;return d||(a("body").on("keydown.glv",function(b){return b.keyCode===a.ui.keyCode.ESCAPE?void i._cancel(b):void i._dragCopyOrMove(b.ctrlKey)}),a("body").on("keyup.glv",function(a){i._dragCopyOrMove(a.ctrlKey)})),this.helper||(this.helper=this._createHelper()),this.margins={left:parseInt(this.dragComponent.css("marginLeft"),10)||0,top:parseInt(this.dragComponent.css("marginTop"),10)||0},this.scrollParent=this.helper.scrollParent(),this.offset=this.dragComponent.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},a.extend(this.offset,{click:{left:c.pageX-this.offset.left,top:c.pageY-this.offset.top},parent:this._getParentOffset()}),this.helper.css("position","absolute"),this._cacheHelperProportions(),this.originalPosition=this._generatePosition(c),h.cursorAt&&this._adjustOffsetFromHelper(h.cursorAt),this.dragging=!0,f=this.dragComponent.children("h3").outerHeight(),this.dragComponent.hide(),this._createPlaceholder(f),g=this.placeholder.offset().top,this._initTargetContainers(),g=this.placeholder.offset().top-g,g>0&&(this.scrollParent[0].scrollTop=this.scrollParent[0].scrollTop+g),this._refreshPositions(),h.containment&&this._setContainment(),d||h.cursor&&"auto"!==h.cursor&&(e=a("body"),this.storedCursor=e.css("cursor"),e.css("cursor",h.cursor),this.storedStylesheet=a("<style>*{ cursor: "+h.cursor+" !important; }</style>").appendTo(e)),h.opacity&&this.helper.css("opacity",h.opacity),h.zIndex&&this.helper.css("zIndex",h.zIndex),this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",c,this._uiHashDnD()),this._mouseDrag(c),!0},_mouseDrag:function(b){var c,d,e,g,h,i,j,k,l,m,n,o,p,q=0,r=0,s=this.options,t=!1,u=!1;for(this.position=this._generatePosition(b),this.positionAbs=this._adjustPositionForScroll(),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-b.pageY<s.scrollSensitivity?this.scrollParent[0].scrollTop=u=this.scrollParent[0].scrollTop+s.scrollSpeed:b.pageY-this.overflowOffset.top<s.scrollSensitivity&&(this.scrollParent[0].scrollTop=u=this.scrollParent[0].scrollTop-s.scrollSpeed),r=this.scrollParent[0].scrollTop-this.dropPositionsOrigin.y,this.overflowOffset.left+this.scrollParent[0].offsetWidth-b.pageX<s.scrollSensitivity?this.scrollParent[0].scrollLeft=u=this.scrollParent[0].scrollLeft+s.scrollSpeed:b.pageX-this.overflowOffset.left<s.scrollSensitivity&&(this.scrollParent[0].scrollLeft=u=this.scrollParent[0].scrollLeft-s.scrollSpeed),q=this.scrollParent[0].scrollLeft-this.dropPositionsOrigin.x):(b.pageY-a(document).scrollTop()<s.scrollSensitivity?u=a(document).scrollTop(a(document).scrollTop()-s.scrollSpeed):a(window).height()-(b.pageY-a(document).scrollTop())<s.scrollSensitivity&&(u=a(document).scrollTop(a(document).scrollTop()+s.scrollSpeed)),r=a(document).scrollTop()-this.dropPositionsOrigin.y,b.pageX-a(document).scrollLeft()<s.scrollSensitivity?u=a(document).scrollLeft(a(document).scrollLeft()-s.scrollSpeed):a(window).width()-(b.pageX-a(document).scrollLeft())<s.scrollSensitivity&&(u=a(document).scrollLeft(a(document).scrollLeft()+s.scrollSpeed)),q=a(document).scrollLeft()-this.dropPositionsOrigin.x)),this.positionAbs=this._adjustPositionForScroll(),this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",this._dragCopyOrMove(b.ctrlKey),c=0;c<this.containers.length;c++)if(e=this.containers[c],i=this._intersectsWithPointer(e,null,q,r)){if(p=e.type,"grid"===p)for(o=this.positionAbs.top+this.offset.click.top+r,n=this.positionAbs.left+this.offset.click.left+q,j=0;j<e.rows.length;j++){if(k=e.rows[j],f(o,k.y-s.gridTolerance,2*s.gridTolerance)){t=this._movePlaceholder(e,null,"row",j);break}if(j<e.rows.length-1&&f(o,k.y,e.rows[j+1].y-k.y))for(l=0;l<k.columns.length;l++)if(m=k.columns[l],f(n,m-s.gridTolerance,2*s.gridTolerance)){t=this._movePlaceholder(e,null,"column",j,l);break}}if(t)break;if(e.items)for(d=0;d<e.items.length;d++)if(g=e.items[d],i=this._intersectsWithPointer(g,p,q,r)){h=g.element[0],h!==this.dragComponent[0]&&this.placeholder[1===i?"next":"prev"]()[0]!==h&&("pointer"===this.options.tolerance||this._intersectsWithSides(g,p))&&(t=this._movePlaceholder(e,g,1===i?"before":"after"));break}if(t)break;if("grid"!==e.type&&(t=this._movePlaceholder(e)),t)break;
e!==this.curContainer&&(this.curContainer=e);break}return this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(b,c){if(c||a("body").off(".glv"),this._deactivate(),this.storedCursor&&(a("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),!b.target)return this.fromOutside=!1,void(this.dragging=!1);if(this.options.animate){var d=this,e=this.placeholder.offset(),f={};f.left=e.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft),f.top=e.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop),this.animating=!0,a(this.helper).animate(f,parseInt(this.options.animate,10)||500,function(){d._finishDrag(b)})}else this._finishDrag(b);return!1},_initDragTargets:function(a){a.hasClass(x)?(this.targetClass=O,this.itemClass=x):a.hasClass(y)?(this.targetClass=P,this.itemClass=y):a.hasClass(z)&&(this.targetClass=Q,this.itemClass=z)},_dragCopyOrMove:function(a){this.isOver||this.prevCopy===a||(a?(this.dragComponent.show(),this.helper.find(Y).text(d.getMessage("GL.DRAG_COPY"))):(this.dragComponent.hide(),this.helper.find(Y).text("")),this.prevCopy=a)},_cancel:function(a){this.dragging&&(this._mouseUp({target:null}),this.dragComponent.show(),this._select(this.dragComponent,null,!0)),this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper&&this.helper[0].parentNode&&this.helper.remove(),this.helper=null,this.dragging=!1,this.animating=!1),this._trigger("stop",a,this._uiHashDnD())},_intersectsWith:function(a){var b=this.positionAbs.left,c=this.positionAbs.top,d=a.left,e=d+a.width,f=a.top,g=f+a.height,h=this.offset.click.top,i=this.offset.click.left,j="x"===this.options.axis||c+h>f&&g>c+h,k="y"===this.options.axis||b+i>d&&e>b+i;return j&&k},_intersectsWithPointer:function(a,b,c,d){var e=f(this.positionAbs.top+this.offset.click.top+d,a.top,a.height),g=f(this.positionAbs.left+this.offset.click.left+c,a.left,a.width),h=e&&g,i=this._getDragVerticalDirection(),j=this._getDragHorizontalDirection();return h?"flow"===b&&j?"right"===j||"down"===i?2:1:i&&"down"===i?2:1:!1},_intersectsWithSides:function(a,b){var c=f(this.positionAbs.top+this.offset.click.top,a.top+a.height/2,a.height),d=f(this.positionAbs.left+this.offset.click.left,a.left+a.width/2,a.width),e=this._getDragVerticalDirection(),g=this._getDragHorizontalDirection();return"flow"===b&&g?"right"===g&&d||"left"===g&&!d:e&&("down"===e&&c||"up"===e&&!c)},_getDragVerticalDirection:function(){var a=this.positionAbs.top-this.lastPositionAbs.top;return 0!==a&&(a>0?"down":"up")},_getDragHorizontalDirection:function(){var a=this.positionAbs.left-this.lastPositionAbs.left;return 0!==a&&(a>0?"right":"left")},_initTargetContainers:function(){var b,c=this,d="."+this.targetClass,e=a(d,this.element),f=null;this.helper&&(e=e.not(this.helper.find(d))),this.dragComponent&&(e=e.not(this.dragComponent.find(d)),f=this.dragComponent.closest(d)[0]),e.addClass(gb),this.containers=[],this.curContainer=null,e.each(function(){var d,e,g;e=a(this),e.hasClass(R)?d="grid":e.hasClass(T)?d="stack":e.hasClass(U)&&(d="flow"),b={element:e,type:d,name:a(this).prev().text(),width:0,height:0,left:0,top:0},c.containers.unshift(b),this===f&&(c.curContainer=b),"grid"===d?b.rows=[]:(b.items=[],g=s(e),e.children(g).each(function(){b.items.push({element:a(this),name:a(this).children("h3").text(),width:0,height:0,left:0,top:0})}))})},_deactivate:function(){a("."+this.targetClass).removeClass(gb)},_refreshPositions:function(){function b(){l=a(this),h=l.offset(),j.columns.push(h.left)}function c(){k=a(this),h=k.offset(),j={y:h.top,columns:[]},f.rows.push(j),k.children("td").each(b),j.columns.push(h.left+l.outerWidth())}var d,e,f,g,h,i,j,k,l,m;for(k=a(),d=0;d<this.containers.length;d++)if(f=this.containers[d],g=f.element,f.width=g.outerWidth(),f.height=g.outerHeight(),h=g.offset(),f.left=h.left,f.top=h.top,"grid"===f.type)f.rows=[],g.children("tbody").children("tr").each(c),f.rows.push({y:h.top+k.outerHeight()});else for(e=0;e<f.items.length;e++)i=f.items[e],g=i.element,i.width=g.outerWidth(),i.height=g.outerHeight(),h=g.offset(),i.left=h.left,i.top=h.top;this.dropPositionsOrigin={x:0,y:0},m=this.element.scrollParent(),m[0]===document?m=this.element:this.dropPositionsOrigin={x:m[0].scrollLeft,y:m[0].scrollTop},h=m.offset(),this.containerCache.left=h.left,this.containerCache.top=h.top,this.containerCache.width=m.outerWidth(),this.containerCache.height=m.outerHeight()},_createPlaceholder:function(b){this.placeholder=a("<div class='"+ib+"'>&nbsp;</div>"),this.dragComponent.after(this.placeholder),b&&this.placeholder.height(b)},_createHelper:function(){var b=this.options,c=this.makeHelper();return c.parents("body").length||a("parent"!==b.appendTo?b.appendTo:this.element[0].parentNode)[0].appendChild(c[0]),!c[0].style.width,!c[0].style.height,c},_adjustOffsetFromHelper:function(a){"left"in a&&(this.offset.click.left=a.left+this.margins.left),"right"in a&&(this.offset.click.left=this.helperProportions.width-a.right+this.margins.left),"top"in a&&(this.offset.click.top=a.top+this.margins.top),"bottom"in a&&(this.offset.click.top=this.helperProportions.height-a.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var b=this.offsetParent.offset();return this.scrollParent[0]!==document&&a.contains(this.scrollParent[0],this.offsetParent[0])&&(b.left+=this.scrollParent.scrollLeft(),b.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&a.ui.ie)&&(b={top:0,left:0}),{top:b.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:b.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var b,c,d,e=this.options;"parent"===e.containment&&(e.containment=this.helper[0].parentNode),("document"===e.containment||"window"===e.containment)&&(this.containment=[0-this.offset.parent.left,0-this.offset.parent.top,a("document"===e.containment?document:window).width()-this.helperProportions.width-this.margins.left,(a("document"===e.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(e.containment)||(b=a(e.containment)[0],c=a(e.containment).offset(),d="hidden"!==a(b).css("overflow"),this.containment=[c.left+(parseInt(a(b).css("borderLeftWidth"),10)||0)+(parseInt(a(b).css("paddingLeft"),10)||0)-this.margins.left,c.top+(parseInt(a(b).css("borderTopWidth"),10)||0)+(parseInt(a(b).css("paddingTop"),10)||0)-this.margins.top,c.left+(d?Math.max(b.scrollWidth,b.offsetWidth):b.offsetWidth)-(parseInt(a(b).css("borderLeftWidth"),10)||0)-(parseInt(a(b).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,c.top+(d?Math.max(b.scrollHeight,b.offsetHeight):b.offsetHeight)-(parseInt(a(b).css("borderTopWidth"),10)||0)-(parseInt(a(b).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_generatePosition:function(b){var c=b.pageX,d=b.pageY,e=this.scrollParent[0]!==document&&a.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,f=/(html|body)/i.test(e[0].tagName);return this.originalPosition&&this.containment&&(b.pageX-this.offset.click.left<this.containment[0]&&(c=this.containment[0]+this.offset.click.left),b.pageY-this.offset.click.top<this.containment[1]&&(d=this.containment[1]+this.offset.click.top),b.pageX-this.offset.click.left>this.containment[2]&&(c=this.containment[2]+this.offset.click.left),b.pageY-this.offset.click.top>this.containment[3]&&(d=this.containment[3]+this.offset.click.top)),{top:d-this.offset.click.top-this.offset.parent.top-(f?0:e.scrollTop()),left:c-this.offset.click.left-this.offset.parent.left-(f?0:e.scrollLeft())}},_adjustPositionForScroll:function(){var b=this.position,c=this.scrollParent[0]!==document&&a.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,d=/(html|body)/i.test(c[0].tagName);return{top:b.top+this.offset.parent.top-(d?0:c.scrollTop()),left:b.left+this.offset.parent.left-(d?0:c.scrollLeft())}},_makeTempDragComponent:function(){var c,d,e=b.htmlBuilder();return e.markup("<div").attr("class",this.itemClass).markup("><h3 class='is-draggable'><span>&nbsp;</span></h3></div>"),c=a(e.toString()),d=this.element.find("."+this.targetClass).not(S).filter(":visible").first(),d.length?(d.append(c),this.dragComponent=c,!0):!1},_movePlaceholder:function(b,c,d,e,f){var g,h,i,j,k,l,m,n=null,o=null,p=!1;if(c)g=c.element[0],g.parentNode.insertBefore(this.placeholder[0],"before"===d?g:g.nextSibling),p=!0;else if(l=s(b.element),m=t(b.element),"grid"===b.type){if(h=b.element.children("tbody").children("tr"),"row"===d){if(e>=h.length?k=h.last().find(l).filter(":visible").length:(k=h.eq(e).find(l).filter(":visible").length,k>0&&e>0&&(k=h.eq(e-1).find(l).filter(":visible").length)),0===k)return!1;n=a("<tr><td><div class='"+T+" "+m+"'></div></td></tr>"),e>=h.length?h.last().after(n):h.eq(e).before(n),n.find("div").append(this.placeholder[0]),this.containers.unshift({element:n.find("div"),type:"stack",name:"temp",items:[],width:0,height:0,left:0,top:0}),p=!0}else if("column"===d){if(i=h.eq(e),j=i.children("td"),f>=j.length?k=j.last().find(l).filter(":visible").length:(k=j.eq(f).find(l).filter(":visible").length,k>0&&f>0&&(k=j.eq(f-1).find(l).filter(":visible").length)),0===k)return!1;o=a("<td><div class='"+T+" "+m+"'></div></td>"),f>=j.length?j.last().after(o):j.eq(f).before(o),o.find("div").append(this.placeholder[0]),this.containers.unshift({element:o.find("div"),type:"stack",name:"temp",items:[],width:0,height:0,left:0,top:0}),p=!0}}else(!b.items||0===b.items.length||1===b.items.length&&b.items[0].element[0]===this.dragComponent[0])&&(b.element.append(this.placeholder[0]),p=!0);return b!==this.curContainer&&(this.curContainer=b),p&&(this.tempGridRow&&0===this.placeholder.closest(this.tempGridRow).length&&(this.tempGridRow.remove(),this.tempGridRow=null),n&&(this.tempGridRow=n),this.tempGridColumn&&0===this.placeholder.closest(this.tempGridColumn).length&&(this.tempGridColumn.remove(),this.tempGridColumn=null),o&&(this.tempGridColumn=o)),p&&this._refreshPositions(),p},_copyComponent:function(a,b){var c,d,e,f,g={};for(e in a)if(f=a[e],"displayPoints"===e)for(d=g.displayPoints=[],c=0;c<a.displayPoints.length;c++)d.push(this._copyComponent(a.displayPoints[c],g));else if("components"===e)for(d=g.components=[],c=0;c<a.components.length;c++)d.push(this._copyComponent(a.components[c],g));else"_parent"===e?g._parent=b:"_"!==e.substring(0,1)&&(g[e]=f);return this.options.updateComponentCopy(g,a),g},_insert:function(a,b,c,d,f,g,h){var i,k,m,o,p,q,r=this.pageRoot,s=a.component,t=a.newParentContainer;if("button"===s.type&&(l(a,s,"alignment",h),h&&(a.newAlignment=h)),b){for(g===nb||0===t._grids.length?(i={_parent:t,rows:[]},t._grids.splice(c,0,i),l(a,s,"newGrid",!0),a.newGridInserted=!0,g=ob):(l(a,s,"newGrid",!1),i=t._grids[c]),g===ob||d>=i.rows.length?(k={_parentGrid:i,columns:[]},i.rows.splice(d,0,k),a.newRowInserted=!0,g=pb,l(a,s,"newRow",!0)):(l(a,s,"newRow",!1),k=i.rows[d]),g===pb?(m={_parentRow:k,span:-1,col:-1,components:[]},k.columns.splice(f,0,m),a.newColumnInserted=!0,g=0,l(a,s,"newCol",!0),0!==f||a.newRowInserted||l(a,s,"newRow",!0)):(m=k.columns[f],p=m.components[g],0===g?(l(a,s,"newCol",!0),p&&(l(a,s,"newRow",p.newRow),l(a,s,"newGrid",p.newGrid),l(a,s,"col",p.col),l(a,s,"span",p.span),p.rowSpan!==e&&l(a,s,"rowSpan",p.rowSpan),l(a,p,"newCol",!1),l(a,p,"newRow",!1),l(a,p,"newGrid",!1),l(a,p,"col",-1),l(a,p,"span",-1),p.rowSpan!==e&&l(a,p,"rowSpan",-1))):l(a,s,"newCol",!1)),(s.col===e||s.col>=0&&(0!==g||!p)&&!s.forceColumn)&&l(a,s,"col",-1),delete s.forceColumn,s.span===e&&l(a,s,"span",-1),s._parentColumn=m,a.newGrid=c,a.newRow=d,a.newColumn=f,a.newIndex=g,!p&&f+1<k.columns.length&&(p=k.columns[f+1].components[0],a.newColumnInserted&&0===f&&l(a,p,"newRow",!1)),!p&&d+1<i.rows.length&&(p=i.rows[d+1].columns[0].components[0]),!p&&c+1<t._grids.length&&(p=t._grids[c+1].rows[0].columns[0].components[0]),q=p?j(t.components,p):t.components.length,a.newComponentIndex=q,m.components.splice(g,0,s),t.components.splice(q,0,s),p&&p._parentColumn!==s._parentColumn&&0===f&&s.newCol&&l(a,p,"newCol",!0),o=0;o<k.columns.length;o++)m=k.columns[o],m.col=m.components[0].col,m.span=m.components[0].span||-1;"fixed"===r.gridType&&r.hasColumnSpan&&n(k,t.maxColumns)}else a.newIndex=g,t.components.splice(g,0,s);return s._parent=t,g},_getTableColumnFromColumn:function(a,b,c,d){var e,f,g=1,h=0,i=a._grids[b].rows[c].columns;for(e=0;d>=e&&e<i.length;e++)f=i[e],f.col>g&&(h+=1,g=f.col),g+=f.span>0?f.span:1,h+=1;return h-1},_insertInDom:function(b,c,d,e,f,g,i,j,k){var l,m,n,o,p,q,r,s,u,v,w,x=this.pageRoot;o=b.hasClass(z)&&c.children(K).length?c.find(K).find("td").eq("left"===k?0:1).children(ab):c.children(ab),this.placeholder?this.placeholder.before(b):o.is(S)?(u=t(c),v=i,0>v&&(v=0),i===nb&&d._grids.length>1?(p=a("<table><tbody></tbody></table>"),h(o.parent(),"table",p,e),i=ob,v=0):p=o.parent().children("table").eq(e),i===ob&&0===e&&d._grids[e].rows.length>1?(m="<td><div class='"+T+" "+u+"'></div></td>",d._grids[e].rows[f].columns[0].col>=0&&(m+=m),q=a("<tr>"+m+"</tr>"),h(p.children("tbody"),q,f),v=0):q=p.children("tbody").children("tr").eq(f),w=this._getTableColumnFromColumn(d,e,f,g),i===pb?(d._grids[e].rows[f].columns[g].col>=0&&(r=a("<td><div class='"+T+" "+u+"'></div></td>"),h(q,r,w-1)),r=a("<td><div class='"+T+" "+u+"'></div></td>"),h(q,r,w),v=0):r=q.children().eq(w),h(r.children().eq(0),b,v)):h(o,b,i),"fixed"===x.gridType&&x.hasColumnSpan&&o.is(S)&&(p=o.parent().children("table").eq(e),q=p.children("tbody").children("tr").eq(f),s=d._grids[e].rows[f].columns,l=0,n=1,q.children("td").each(function(){s[l].col>n&&(this.colSpan=s[l].col-n,n=s[l].col),n+=s[l].span>0?s[l].span:1,a(this).find(Z).length>0&&(this.colSpan=s[l].span,l+=1)})),j&&this._showOrHideDisplayPoints(b)},_add:function(c,d,e,f,g,h,i,j){var k,l,m,n=!1,o=b.htmlBuilder(),p={container$:d,propertyChanges:[]};return p.newParentContainer=k=this._getNode(d[0]),m=a.isArray(k._grids),c.displayPoints&&(l=12,this._layoutDisplayPoints(c.displayPoints,c,m,l)),j?(this._setNode(c),j[0].id=this.baseId+c._elementId):(this._renderComponent(o,c,m),j=a(o.toString()),n=!0),p.newComponent$=j,p.component=c,this._insert(p,m,e,f,g,h,i),this._insertInDom(p.newComponent$,d,k,e,f,g,h,n,i),p},_remove:function(b,c,d){var e,f,g,h,k,m,o,p,q,r,s,t,u,v,w,x,y=this.pageRoot,z=this,A=!!d;if(c=c||{propertyChanges:[]},g=this._getNode(b[0]),d=d||b.parent(),A?b.hide():(c.component$=b,c.component=g,c.prevContainer$=b.closest(_),delete this.nodeMap[i(b[0].id)],b.find(Z).each(function(){delete z.nodeMap[i(this.id)]}),b.remove()),x="TD"===d[0].parentNode.nodeName&&d.closest("table").is(S),c.prevParentContainer=r=g._parent,c.prevComponentIndex=t=j(r.components,g),c.prevIndex=c.prevComponentIndex,"button"===g.type&&g.alignment&&(c.prevAlignment=g.alignment),x&&0===d.children(":visible").length&&(f=d.parent().parent(),f.parent().children("tr").length>1&&0===f.find(Z).filter(":visible").length?f.remove():f.children("td").length>1&&(q=d.parent().prev().eq(0),d.parent().remove(),0===q.find(Z).filter(":visible").length&&q.remove())),x){if(h=g._parentColumn,s=j(h.components,g),u=0,v=j(h._parentRow._parentGrid.rows,h._parentRow),w=j(h._parentRow.columns,h),c.prevGrid=u,c.prevRow=v,c.prevColumn=w,c.prevIndex=s,0===s&&h.components.length>1&&(o=h.components[1],l(c,o,"newGrid",g.newGrid),l(c,o,"newRow",g.newRow),l(c,o,"newCol",g.newCol),l(c,o,"col",g.col),l(c,o,"span",g.span),g.rowSpan&&l(c,o,"rowSpan",g.rowSpan)),m=r._grids[u],k=m.rows[v],h=k.columns[w],h.components.splice(s,1),0===h.components.length&&(k.columns.splice(w,1),0===w&&k.columns.length>0&&(o=k.columns[w].components[0],l(c,o,"newRow",!0)),c.prevColumnRemoved=!0,k.columns.length>0)){if("fixed"===y.gridType&&y.hasColumnSpan){for(e=0;e<k.columns.length;e++)h=k.columns[e],h.col=h.components[0].col,h.span=h.components[0].span||-1;n(k,r.maxColumns)}p=k.columns,e=0,f.children("td").each(function(){a(this).find(Z).length>0&&(p[e].span>0&&(this.colSpan=p[e].span),e+=1)})}0===k.columns.length&&(m.rows.splice(v,1),c.prevRowRemoved=!0),0===m.rows.length&&(r._grids.splice(u,1),c.prevGridRemoved=!0)}return A&&b.show(),r.components.splice(t,1),delete g._parent,c},_moveOrCopy:function(c,d,e,f,g,h,j,k){var l,m,n,o,p,q=!1,r=!1,s=b.htmlBuilder(),t={container$:d,propertyChanges:[]};return l=this._getNode(c[0]),t.newParentContainer=o=this._getNode(d[0]),n=a.isArray(o._grids),t.prevContainer$=c.closest(_),k?(t.originalComponent=l,l=this._copyComponent(l),p=12,l.displayPoints&&this._layoutDisplayPoints(l.displayPoints,l,n,p),this._renderComponent(s,l,n),t.newComponent$=a(s.toString()),q=!0):(m=c.parent(),r="TD"===m[0].parentNode.nodeName,t.newComponent$=c,l.displayPoints&&n!==r&&(p=12,this._layoutDisplayPoints(l.displayPoints,l,n,p),this._renderComponent(s,l,n),t.newComponent$=a(s.toString()),q=!0,c.remove(),delete this.nodeMap[i(c[0].id)])),t.component=l,k||(this._remove(t.newComponent$,t,m),r&&t.prevParentContainer===t.newParentContainer&&(t.prevColumnRemoved&&t.prevColumn<g&&f===t.prevRow&&(g-=1),t.prevRowRemoved&&t.prevRow<f&&e===t.prevGrid&&(f-=1),t.prevGridRemoved&&t.prevGrid<e&&(e-=1))),this._insert(t,n,e,f,g,h,j),this._insertInDom(t.newComponent$,d,o,e,f,g,h,q,j),t},_finishDrag:function(b){var c,d,e,f,h,i,j,k,l,m,n,o,p,q=b.ctrlKey,r=[];for(this.animating=!1,(this.dragComponent.next()[0]!==this.placeholder[0]||q||this.fromOutside)&&(k=this.placeholder.closest(_),m=g(this.placeholder),h=null,i=null,j=null,k.children("table.a-GridLayout-grid").length>0?(d=this.placeholder.closest("td"),j=0,d.parent().children("td").each(function(){return this===d[0]?!1:void(a(this).children("."+T).children().length>0&&(j+=1))}),e=d.parent(),i=g(e),h=k.children("table").index(e.parent().parent()),0===m&&1===this.placeholder.parent().children(":visible").length&&(m=1===e.parent().children().length&&1===e.children().length?nb:1===e.children().length?ob:pb)):k.children("table.a-GridLayout-buttonRow").length>0&&(d=this.placeholder.closest("td"),p=0===g(d)?"left":"right"),this.fromOutside?(o=this.helper.attr("data-type-id"),f=this.options.makeComponent(o),this.dragComponent.remove(),n=this._add(f,k,h,i,j,m,p),r.push(function(a){this._trigger("added",a,n)})):(n=this._moveOrCopy(this.dragComponent,k,h,i,j,m,p,q),r.push(function(a){this._trigger(q?"copied":"moved",a,n)}))),n&&(l=n.newComponent$),this.fromOutside&&r.push(function(a){this._trigger("deactivate",a,this._uiHashDnD(this))}),this.dragComponent.show(),this.dragging=!1,this.tempGridRow=null,this.tempGridColumn=null,this._trigger("beforeStop",b,this._uiHashDnD()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.placeholder=null,this.helper.remove(),this.helper=null,c=0;c<r.length;c++)r[c].call(this,b);return this._trigger("stop",b,this._uiHashDnD()),n&&this._select(l,b,!0),this.fromOutside=!1,!0},_trigger:function(){a.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHashDnD:function(b){var c=b||this;return{helper:c.helper,placeholder:c.placeholder||a([]),position:c.position,originalPosition:c.originalPosition,offset:c.positionAbs,item:c.dragComponent,sender:b?b.element:null}}}),a.apex.gridlayout.INDEX={NEW_GRID:nb,NEW_ROW:ob,NEW_COLUMN:pb},a.ui.plugin.add("draggable","connectToGridlayout",{start:function(b,c){var d=a(this).data("ui-draggable"),e=d.options,f=a.extend({},c,{item:d.element});a("body").on("keydown.glvplug",function(b){b.keyCode===a.ui.keyCode.ESCAPE&&(d.dropped=!1,d.cancel())}),d.grids=[],a(e.connectToGridlayout).each(function(){var e=a.data(this,"apex-gridlayout");e&&!e.options.disabled&&(d.grids.push({instance:e}),e._initDragTargets(c.helper),e._initTargetContainers(),e._refreshPositions(),e._trigger("activate",b,f))})},stop:function(b,c){var d,e=a(this).data("ui-draggable");a("body").off(".glvplug"),a.each(e.grids,function(){this.instance.isOver&&!this.invalid?(this.instance.isOver=!1,e.cancelHelperRemoval=!0,b.target?this.instance._mouseStop(b,!0):(this.instance._mouseStop(b,!0),this.instance.dragComponent.remove(),this.instance._cancel(b))):(this.instance._deactivate(),d=a.extend({},c,{item:e.element}),this.instance._trigger("deactivate",b,d))})},drag:function(b,c){var d=a(this).data("ui-draggable");a.each(d.grids,function(){var a=!1;if(!this.invalid)if(this.instance.positionAbs=d.positionAbs,this.instance.helperProportions=d.helperProportions,this.instance.offset.click=d.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(a=!0),a){if(!this.instance.isOver){if(this.instance.isOver=!0,!this.instance._makeTempDragComponent())return this.instance.isOver=!1,void(this.invalid=!0);if(this.instance.helper=c.helper,this.instance.helper.css("position","relative"),b.target=this.instance.dragComponent.children("h3")[0],!this.instance._mouseCapture(b,!0))return this.instance.isOver=!1,void(this.invalid=!0);this.instance._trigger("over",b,this.instance._uiHashDnD(this.instance)),this.instance._mouseStart(b,b,!0),this.instance.offset.click.top=d.offset.click.top,this.instance.offset.click.left=d.offset.click.left,this.instance.offset.parent.left-=d.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=d.offset.parent.top-this.instance.offset.parent.top,d.dropped=this.instance.element,d.currentItem=d.element,this.instance.fromOutside=d}this.instance.dragComponent&&this.instance._mouseDrag(b)}else this.instance.isOver&&(this.instance.isOver=!1,this.instance._trigger("out",b,this.instance._uiHashDnD(this.instance)),b.target=null,this.instance._mouseStop(b,!0),this.instance.dragComponent.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),d.dropped=!1)})}})}(apex.jQuery,apex.util,apex.debug,apex.lang);